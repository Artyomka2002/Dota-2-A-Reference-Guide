var WSB;(function(n){var t;(function(n){function t(...n){let t=[];for(let i of n)if(i)if(typeof i=="string")t.push(i);else for(let n in i)i[n]&&t.push(n);return t.length>0?t.join(" "):null}function i(n){return ThresholdUtilities.getUrlParameter(location.search,"isTest")?n:undefined}n.ViewData={};n.classNames=t;n.whenTestHooks=i})(t=n.View||(n.View={}))})(WSB||(WSB={})),function(n){var t;(function(n){class t extends React.Component{componentDidMount(){this.props.adjustHeight&&this.props.adjustHeight()}componentDidUpdate(){this.props.adjustHeight&&this.props.adjustHeight()}}n.DynamicHeightView=t})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{render(){const{suggestion:i,openPreviewPaneButton:r}=this.props,u="OpenWebPreviewPaneTooltip",f="OpenLocalPreviewPaneTooltip",o=(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isWorkScope(i.handoffType))&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkScopeListViewEnabled());if(!r||!i.previewPaneType)return null;const e=i.previewPaneType==1;return React.createElement("div",{className:"openPreviewPaneBtn",onClick:t=>{((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isWorkScope(i.handoffType))&&i.type=="MVALL"||o&&n.isMsbSubverticalOnlineSuggestionType(i.type))&&n.InstrumentationHelper.logClientInstEvent("Select","WorkScopePillSelect",undefined,{suggestionType:i.type}),r.clickHandler(i,t)},"data-partnertag":t.whenTestHooks("Suggestion.OpenPreviewPaneButton"),"data-noct":"true",role:"button",title:t.getLocString(e?u:f),"aria-label":t.getLocString(e?u:f)},React.createElement("span",{className:"openPreviewIcon",role:"presentation"},React.createElement(t.Icon,{icon:r.defaultIcon})),React.createElement("span",{className:"previewOpenedIcon",role:"presentation"},React.createElement(t.Icon,{icon:r.openedIcon})))}}t.PreviewPaneButton=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{render(){const{icon:i}=this.props;if(!i)return null;const r=n.getRemoveIconTitleAndAriaLabel(i.title);return React.createElement("span",{className:t.classNames("removeIcon",{selected:i.selected}),title:r,"aria-selected":i.selected?"true":"false","aria-label":r,role:"option",onClick:t=>{t.nativeEvent.stopPropagation(),t.stopPropagation(),n.invokeClickHandler(i.click,t.nativeEvent)},"data-partnertag":t.whenTestHooks("Suggestion.RemoveIcon")},React.createElement(t.Icon,{icon:i.icon}))}}t.RemoveIcon=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){t.WindowsDialogBox=i=>{const{isModal:f,isVisible:e,title:r,messageText:o,buttons:u}=i.dataModel;return(React.useEffect(()=>{let t=u===null||u===void 0?void 0:u.filter(n=>n.selected)[0];return t&&n.safeSetTimeout(()=>{n.Host.setFocusInWebView("dialogBoxViewModel"),_ge(t.id).focus()},30,"DialogBox.show"),()=>{n.Host.setFocusInSearchBox(null,"updateDialogBox: hidden")}},[e]),!e)?null:React.createElement("div",{id:"dialog_overlay","data-partnertag":t.whenTestHooks("DialogBoxOverlay"),className:t.classNames({wsbModal:f})},React.createElement("div",{className:"dialogBox","data-partnertag":t.whenTestHooks("DialogBox")},React.createElement("div",{className:"dialogText"},n.config.useCobaltCSS&&r&&React.createElement("p",{className:"uninstallTitle"},r),!n.config.useCobaltCSS&&r&&React.createElement("h1",null,r),React.createElement("p",null,o)),React.createElement("div",{className:"dialogBtnContainer"},u.map(n=>React.createElement("input",{type:"button",key:n.id,className:t.classNames({colored:n.useAccentColor,focusable:f}),value:n.text,id:n.id,tabIndex:-1,"data-partnertag":t.whenTestHooks("DialogBoxButton")})))))}})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends t.DynamicHeightView{render(){const{dataModel:f}=this.props;if(!f)return null;const{clickHandler:e,messageText:o,title:r,action:i,icon:u,messageClassName:s}=f;return React.createElement("div",{className:t.classNames("visible",s),"data-partnertag":t.whenTestHooks("Message"),onClick:n=>e&&e(n.nativeEvent)},React.createElement("div",{className:t.classNames("message","itemTooltip",{messageWithAction:i!=null})},u&&React.createElement(t.Icon,{icon:u}),React.createElement("div",{className:t.classNames({details:u!=null})},React.createElement("div",{className:"primaryText",role:"status","aria-label":o},React.createElement("span",{"aria-hidden":"true"},o)),i&&React.createElement("div",{className:t.classNames("primaryText","accentColor","selectable",{sa_hv:i.selected}),onClick:t=>n.invokeClickHandler(i.click,t.nativeEvent),id:i.id,tabIndex:-1,"data-h":i.instItem.getHValue(),"data-partnertag":t.whenTestHooks("AutoSuggest.WindowsMessageAction"),"data-clicks":"true",title:r,"aria-label":r,onFocus:()=>n.focusedToolTipHandler(`#${i.id}`,"title",r),onBlur:()=>n.focusedToolTipHandler(`#${i.id}`,"title",r)},i.text))))}}t.WindowsMessage=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class r extends React.Component{constructor(){super(...arguments);this.shouldComponentUpdate=(t,i)=>n.shouldComponentUpdateOverload(this,t,i)}render(){const{advancedOptions:n,additionalClass:i}=this.props;return!n||n.length==0?null:React.createElement("div",{className:t.classNames("advancedOptions",i)},n.map(n=>React.createElement("div",{key:n.id,id:n.id,className:t.classNames("advancedOption",n.cssClass,{selectable:n.selected,sa_hv:n.selected,withoutPadding:n.layout==6})},n.title&&React.createElement("h4",{className:"groupHeader groupTitle"},n.title),React.createElement(u,{option:n}))))}}t.AdvancedOptions=r;const u=n=>{const{option:r}=n;let t=[];switch(r.layout){case 1:t.push(React.createElement(e,{option:r}));t.push(React.createElement(i,{dismiss:r.dismiss}));break;case 6:t.push(React.createElement(o,{option:r}));break;default:t.push(React.createElement(f,{option:r}));t.push(React.createElement(i,{dismiss:r.dismiss}))}return t?React.createElement("div",null,t):null},f=i=>{const{option:r}=i;return React.createElement("div",null,r.message&&React.createElement("p",{className:"advancedOptionHeading"},r.message),React.createElement("input",{type:"button",role:"button",className:"focusable","data-partnertag":t.whenTestHooks("AutoSuggest.TopHitHeader.AdvancedOption"),tabIndex:-1,onClick:t=>n.invokeClickHandler(r.click,t.nativeEvent),"data-h":r.instItem?r.instItem.getHValue():undefined,"aria-selected":r.selected,"aria-label":r.narratorText,"data-clicks":"true",value:r.text}))},e=i=>{const{option:r}=i;return React.createElement("div",null,React.createElement(t.Icon,{icon:r.icon}),React.createElement("div",{className:"details"},React.createElement("a",{href:"#",className:"accentColor focusable additionalInfoText","data-partnertag":t.whenTestHooks("AutoSuggest.TopHitHeader.AdvancedOption"),tabIndex:-1,onClick:t=>n.invokeClickHandler(r.click,t.nativeEvent),"data-h":r.instItem?r.instItem.getHValue():undefined,"data-clicks":"true"},r.message)))},o=i=>{const{option:r}=i;return React.createElement("div",null,React.createElement("div",{className:"messageWithButton"},r.icon&&React.createElement(t.Icon,{icon:r.icon}),React.createElement("span",{className:"advancedOptionMessage",tabIndex:-1,"data-h":r.instItem?r.instItem.getHValue():undefined,"data-clicks":"true"},r.message),React.createElement("input",{type:"button",role:"button",className:"focusable advancedOptionButton","data-partnertag":t.whenTestHooks("AutoSuggest.TopHitHeader.AdvancedOption"),tabIndex:-1,onClick:t=>n.invokeClickHandler(r.click,t.nativeEvent),"data-h":r.instItem?r.instItem.getHValue():undefined,"aria-selected":r.selected,"aria-label":r.narratorText,"data-clicks":"true",value:r.buttonLabel}),!!r.dismiss&&React.createElement("div",{className:"advancedOptionDimiss",onClick:()=>r.dismiss.action(),role:"button"},React.createElement(t.Icon,{icon:r.dismiss.icon}))))},i=n=>{const{dismiss:i}=n;return i?React.createElement("a",{href:"#","data-partnertag":t.whenTestHooks("AdvancedOption.Dismiss"),"aria-label":t.getLocString("DismissUpsell"),title:t.getLocString("DismissUpsell"),className:"cancelIcon focusable",onClick:()=>i.action(),tabIndex:-1},React.createElement(t.Icon,{icon:i.icon})):null}})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{constructor(){super(...arguments);this.shouldComponentUpdate=(t,i)=>n.shouldComponentUpdateOverload(this,t,i)}render(){const{dataModel:e}=this.props;if(!e)return null;const{headerText:u,message:i,subMessage:f,messageIcon:s,isTwoColumnsLayout:h,freDataModel:n,instItem:r}=e,o=(n===null||n===void 0?void 0:n.isWorkScopeZi)&&!!i;return React.createElement("div",{className:o?"topHitHeaderContainer":null,"data-region":r?"NoResult":null},u&&React.createElement("div",{className:"groupHeader"},React.createElement("h4",{className:"groupTitle","aria-label":u},u)),o&&React.createElement(t.MsbFreContainer,{dataModel:n}),!n&&!!i&&React.createElement("div",{"data-h":r===null||r===void 0?void 0:r.getHValue(),className:t.classNames("scopeMessage",{scopeTwoColumsLayout:h}),role:"status"},React.createElement(t.Icon,{icon:s}),React.createElement("p",{className:"details","aria-level":0,"aria-label":i,role:"heading","data-partnertag":t.whenTestHooks("message")},i),!!f&&React.createElement("p",{className:"additionalDetails","aria-level":0,"aria-label":f,role:"heading","data-partnertag":t.whenTestHooks("subMessage")},f)))}}t.TopHitHeader=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{render(){const{dataModel:i}=this.props,l=n.config.useCobaltCSS;if(!i)return null;const{title:r,icon:u,message:f,buttonMessage:e,buttonDismissMessage:o,tooltip:s,buttonClickHandler:h,dismissClickHandler:c}=i,a=React.createElement("div",{className:"upsell"},React.createElement("div",{className:"upsellAreaTitle"},React.createElement("h3",{className:"upsellTitle"},r),React.createElement("a",{href:"#",id:"workUpsellDismiss",className:"upsellDismiss focusable",role:"button","aria-label":o,onClick:t=>n.invokeClickHandler(c,t.nativeEvent),"data-partnertag":t.whenTestHooks("UpsellArea.Dismiss"),tabIndex:-1},React.createElement(t.Icon,{icon:{content:"&#xE711",type:2}}))),React.createElement("hr",null),React.createElement("div",{className:"upsellAreaContent"},React.createElement(t.Icon,{icon:u}),React.createElement("div",{className:"upsellText"},React.createElement("p",{className:"upsellMessage"},f))),React.createElement("button",{className:"upsellButton focusable",id:"workUpsellButton",title:s,onClick:t=>n.invokeClickHandler(h,t.nativeEvent)},React.createElement(t.Icon,{icon:{content:"&#xE721",type:2}}),e)),v=React.createElement("div",{className:"upsell"},React.createElement("div",{className:"upsellAreaTitle"},React.createElement("h3",{className:"upsellTitle"},r)),React.createElement("div",{className:"upsellAreaContent"},React.createElement("div",{className:"upsellText"},React.createElement("p",{className:"upsellMessage"},f)),React.createElement(t.Icon,{icon:u})),React.createElement("div",{className:"upsellButtonArea"},React.createElement("button",{className:"upsellButton focusable",id:"workUpsellButton",title:s,onClick:t=>n.invokeClickHandler(h,t.nativeEvent)},e),React.createElement("button",{className:"upsellButton focusable",id:"workUpsellDismiss",onClick:t=>n.invokeClickHandler(c,t.nativeEvent)},o)));return l?v:a}}t.WorkUpsellBanner=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends t.DynamicHeightView{constructor(){super(...arguments);this.shouldComponentUpdate=(t,i)=>!n.config.reactGroups||n.shouldComponentUpdateOverload(this,t,i)}render(){const{suggestions:i,clickHandler:r,contextMenuHandler:u,openPreviewPaneButton:o,isSearchHome:s,notifyIconPending:f,notifyIconReadyOrFailed:e}=this.props,h=(n.config===null||n.config===void 0?void 0:n.config.enableAutoSuggestMultiEntity)&&i&&i.length>1&&i.findIndex(n=>!!n.secondaryIcon)>0;return React.createElement("div",{className:t.classNames(n.RuntimeConfig.FlatListWithoutGroups?"group":"topResults")},i.map((i,c)=>n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9?React.createElement(t.WindowsSuggestionFileExplorer,{key:`${i.id}_${c}`,suggestion:i,contextMenuHandler:u,clickHandler:r,topResult:!0,notifyIconPending:f,notifyIconReadyOrFailed:e,where:"WindowsTopResults.WindowsSuggestionFileExplorer"}):i.staticGroupType&&i.staticGroupType==n.GroupType.Upsell?React.createElement(t.UpsellSuggestion,{key:`${i.id}_${c}`,suggestion:i,clickHandler:r,contextMenuHandler:u,topResult:!0,notifyIconPending:f,notifyIconReadyOrFailed:e,where:"WindowsTopResults.UpsellSuggestion"}):React.createElement(t.WindowsSuggestionThreeLines,{key:`${i.id}_${c}`,suggestion:i,contextMenuHandler:u,clickHandler:r,openPreviewPaneButton:o,isSearchHome:s,topResult:!0,notifyIconPending:f,notifyIconReadyOrFailed:e,where:"WindowsTopResults.WindowsSuggestionThreeLines",withWebSibling:h})))}}t.WindowsTopResults=i})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{constructor(t){super(t);this.shouldComponentUpdate=(t,i)=>!n.config.reactGroups||n.shouldComponentUpdateOverload(this,t,i);this.state={icon:null}}componentWillMount(){var t;if(n.config.reactGroups&&this.props.suggestion.getIcon&&!this.state.icon){let i=n.SequenceNumberManager.getSequenceNumber();(t=this.props)===null||t===void 0?void 0:t.notifyIconPending(i,this.props.topResult,this.props.where);this.props.suggestion.getIcon(n.RootViewModel.getImageSize(n.Host.getQuery(),this.props.suggestion,this.props.topResult),t=>{n.populateImageRatio(t,this.props.suggestion.type,()=>{var n;(n=this.props)===null||n===void 0?void 0:n.notifyIconReadyOrFailed(i,this.props.topResult,"wsfe-"+this.props.where);this.setState({icon:t})})})}}render(){var i;const{suggestion:n,clickHandler:u,contextMenuHandler:f}=this.props;if(!n)return null;const e=t.classNames("suggestion",{sa_hv:n.selected&&!n.selectedStyleSuspended,selectable:!!n.click},n.classNames.join(" "));return React.createElement("li",{className:e,onContextMenu:t=>f(n,t.nativeEvent),onClick:t=>u(n,t.nativeEvent),id:n.id,"data-partnertag":t.whenTestHooks("AutoSuggest.RegularSuggestion"),"aria-selected":n.selected?"true":"false","aria-label":n.narratorText,"data-stype":t.whenTestHooks(n.type),"data-h":n.instItem.getHValue(),"data-clicks":n.isReformulation?"true":null,"data-noct":n.isReformulation?"true":null,title:n.tooltip},React.createElement("div",{className:"suggDetailsContainer","data-partnertag":t.whenTestHooks("Suggestion.SuggDetailsContainer")},React.createElement(t.Icon,{icon:(i=this.state.icon)!==null&&i!==void 0?i:n.icon}),React.createElement(r,{suggestion:n})))}}t.WindowsSuggestionFileExplorer=i;class r extends React.Component{render(){const{suggestion:i}=this.props;let r=i.primaryMetadata;return React.createElement("div",{className:"details"},React.createElement("div",{className:"primaryText","data-partnertag":t.whenTestHooks("Suggestion.PrimaryText")},React.createElement("div",null,React.createElement("span",{className:"title"},React.createElement(t.HighlightedText,{text:i.text,dir:"ltr",reverse:n.hasReverseHighlighting(i)})),!!r&&React.createElement("span",{className:"secondaryText annotation"},React.createElement(t.HighlightedText,{text:r})))),React.createElement(t.RemoveIcon,{icon:i.removeIcon}))}}})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{constructor(t){super(t);this.shouldComponentUpdate=(t,i)=>!n.config.reactGroups||n.shouldComponentUpdateOverload(this,t,i);this.state={icon:null,storeAppsInstalled:!0}}componentWillMount(){var t,i,r;if(n.config.reactGroups&&this.props.suggestion.getIcon&&!this.state.icon){let i=n.SequenceNumberManager.getSequenceNumber();(t=this.props)===null||t===void 0?void 0:t.notifyIconPending(i,this.props.isFirst,this.props.where);this.props.suggestion.getIcon(n.RootViewModel.getImageSize(n.Host.getQuery(),this.props.suggestion,this.props.isFirst),t=>{n.populateImageRatio(t,this.props.suggestion.type,()=>{var n;(n=this.props)===null||n===void 0?void 0:n.notifyIconReadyOrFailed(i,this.props.isFirst,"wssl-"+this.props.where);this.setState({icon:t})})})}if(n.config.enableWinStoreAppPreview&&n.config.reactGroups&&((i=this.props.suggestion)===null||i===void 0?void 0:i.type)==="SPP"){let t=(r=this.props.suggestion)===null||r===void 0?void 0:r.productName;if(t){let i=n.Host.getAllInstalledAppsByQueryInCurrentConversation(t);i&&i.length>0&&(i===null||i===void 0?void 0:i.includes(t.toLowerCase()))?(this.props.suggestion.installed=!0,this.props.suggestion.suppressed=!0):(i&&this.setState({storeAppsInstalled:!1}),n.OnlineSuggestionsParser.getAllAppsInstalledInLocal(t).then(n=>{n&&n.length>0&&(n===null||n===void 0?void 0:n.includes(t.toLowerCase()))?(this.props.suggestion.installed=!0,this.props.suggestion.suppressed=!0):this.setState({storeAppsInstalled:!1})}))}}}render(){var s,h,c,l,a,v,y,p;const{suggestion:i,openPreviewPaneButton:b,isSearchHome:k,isFirst:ut,clickHandler:ft,webSuggestionAnnotation:et,contextMenuHandler:ot,groupInfo:u,index:e}=this.props;if(!i||n.config.enableWinStoreAppPreview&&i.type==="SPP"&&this.state.storeAppsInstalled===!0)return null;const st=!!i.previewPaneType,d=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isWorkScope(i.handoffType),ht=t=>(u===null||u===void 0?void 0:u.text)&&t===0?`${u.text} ${n.Host.getLocString("Group")},${i.narratorText}`:i.narratorText,g=(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isDocumentZeroQueryEnabled())&&n.Host.getQuery().scope===n.Scope.Documents,w=n.config.enableAutoSuggestMultiEntity&&!!i.secondaryIcon;let nt=(u===null||u===void 0?void 0:u.instRegionName)==="TrendingSearchData"&&(e===0||e===1)&&!!((s=i.icon)===null||s===void 0?void 0:s.content)&&n.isTSInSearchBoxEnabled(),ct=t.classNames("suggestion",{sa_hv:i.selected&&!i.selectedStyleSuspended,arrowOrTabAction:i.arrowOrTabAction&&i.selected,selectable:!!i.click||i.type==="SPP",selected:i.selected,withOpenPreviewPaneBtn:b&&st&&!(n.config.disableQFPreviewBtnForChatSugg&&n.searchChatIconClassName()===((h=i.icon)===null||h===void 0?void 0:h.className)),previewPaneOpened:d?i.selected:i.hasPreviewPaneOpened,previewPaneOpening:i.isPreviewPaneOpening,removeIconPadding:!!i.removeIcon,entityWithThumb:w,dynamicTsSuggestion:nt},i.classNames.join(" "));const tt=i;if(i.staticGroupType==n.GroupType.RecommendedDocs&&g&&!tt.url)return null;if(n.config.enableWinStoreAppPreview&&i.type==="SPP"&&this.state.storeAppsInstalled===!1){const n=document.getElementById("Storegr10");n&&((c=n.classList)===null||c===void 0?void 0:c.remove("b_hide"))}let lt=(n.config.codexBtnInQuickSearches1||n.config.codexBtnInQuickSearches2)&&((l=i.icon)===null||l===void 0?void 0:l.type)==9&&n.isCodexEligible();const o=SearchAppWrapper.CortanaApp.entryPoint,at=n.isTextUpsized();let it="";i.type=="TOPL"&&at&&(it=o=="WNSSTB"||o=="WNSSSB"||o=="WNSPBS"||o=="WNSGLY"?"80px":"95px");const rt={height:it};return React.createElement("li",{className:ct,onContextMenu:n=>ot(i,n.nativeEvent),onClick:n=>ft(i,n.nativeEvent),id:i.id,"data-partnertag":t.whenTestHooks("AutoSuggest.RegularSuggestion"),"aria-selected":i.selected?"true":"false","aria-label":ht(e!==null&&e!==void 0?e:-1),"aria-level":k?1:2,"data-stype":t.whenTestHooks(i.type),"data-h":i.instItem.getHValue(),"data-clicks":i.isReformulation?"true":null,"data-noct":i.isReformulation?"true":null,title:(a=i.tooltip)!==null&&a!==void 0?a:i.query,role:"option",draggable:!0,onDragStart:t=>n.RootViewModel.handleSuggestionDragStartEvent(t,i),style:rt},React.createElement("div",{className:"suggContainer"},React.createElement("div",{className:t.classNames("suggDetailsContainer",{leftPill:i.selected}),"data-partnertag":t.whenTestHooks("Suggestion.SuggDetailsContainer"),style:rt},lt?React.createElement("div",{className:"iconContainer"},React.createElement("div",{className:"icon"},n.config.optimizeScopesReactRender?React.createElement(t.ChatWithBingV2,null):React.createElement(t.ChatWithBing,null))):w?React.createElement(t.Icon,{icon:i.secondaryIcon,type:"SecondaryIcon",additionalCssClass:"largeIconSize"}):nt?React.createElement("div",{className:"wsb-ts__img",style:{backgroundImage:`url(${(v=i.icon)===null||v===void 0?void 0:v.content})`}}):React.createElement(t.Icon,{icon:(y=this.state.icon)!==null&&y!==void 0?y:i.icon,suggestionType:i.type}),React.createElement(f,{suggestion:i,isFirst:ut,webSuggestionAnnotation:et,isWorkScope:d,isSearchHome:k,entityWithThumb:w}),i.staticGroupType==n.GroupType.RecommendedDocs&&g&&React.createElement("div",null,React.createElement(r,{url:tt.url,suggestion:i}))),!(n.config.disableQFPreviewBtnForChatSugg&&n.searchChatIconClassName()===((p=i.icon)===null||p===void 0?void 0:p.className))&&React.createElement(t.PreviewPaneButton,{suggestion:i,openPreviewPaneButton:b}),i.subItems&&i.subItems.map(n=>{let t=React.createElement(n.itemView,Object.assign({subItem:n},n.props));return t.key=n.id,t})))}}t.WindowsSuggestionSingleLine=i;const r=n=>{const[i,r]=React.useState(!1),{url:f,suggestion:e}=n,o=f+"?web=1";return React.createElement("div",{role:"presentation",onClick:n=>{SearchAppWrapper.CortanaApp.copyToClipboard(o,""),n.stopPropagation(),r(!0),window.setTimeout(()=>{r(!1)},2e3)},title:""},React.createElement("a",{className:t.classNames("copyButton"),role:"button","aria-label":e.narratorText,tabIndex:-1,id:"copyButton"},React.createElement("span",{className:"copy"},React.createElement(u,{isCopied:i}),React.createElement(t.Icon,{icon:{content:i?"&#xE73E":"&#xE8C8",type:2},additionalCssClass:"hiddenIcon"}))))},u=i=>{const{isCopied:r}=i;return React.createElement("div",{className:t.classNames("copyHelperText")},r?n.Host.getLocString("Copied"):n.Host.getLocString("CopyFileURL"))},f=i=>{const{suggestion:r,isFirst:c,webSuggestionAnnotation:f,isWorkScope:e,isSearchHome:o,entityWithThumb:s}=i,l=t.classNames("details",{small2Margin:s}),h=n.config.searchHistoryTextColor&&(r.type==="HS"||r.subType==="MRUHS");let u=r.additionalInfoText;return!o&&n.config.enableMruProviderInQF&&r.subType==="MRUHS"&&(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())===3&&(u=undefined),!u&&e&&r.primaryMetadata&&!r.hasMruData&&(u=" - "+r.primaryMetadata),!u&&c&&n.isWebSuggestion(r)&&f&&(u=n.getGroupType(r)===n.GroupType.ChatWithBing?" - "+r.primaryMetadata:f),r.removeIcon&&!r.removeIcon.title&&(r.removeIcon.title=r.narratorText),React.createElement("div",{className:l},!!n.canShowSearchHomeAIFeed()&&r.staticGroupType===n.GroupType.TopApps&&React.createElement("div",{className:"description"},"Take a screen shot"),React.createElement("div",{className:"primaryText","data-partnertag":t.whenTestHooks("Suggestion.PrimaryText")},!u?React.createElement("div",null,React.createElement("span",{className:t.classNames("title",{searchHistoryText:h})},React.createElement(t.HighlightedText,{text:r.text,dir:"ltr",reverse:n.hasReverseHighlighting(r),isWorkScope:e}),r.staticGroupType==n.GroupType.MsbOnRampButton&&React.createElement(t.Icon,{icon:{content:"&#xE974",type:2},additionalCssClass:"onRampChevron"}))):React.createElement("div",null,React.createElement("span",{className:t.classNames("title",{searchHistoryText:h})},React.createElement(t.HighlightedText,{text:r.text,dir:"ltr",reverse:n.hasReverseHighlighting(r)})),!s&&React.createElement(React.Fragment,null,React.createElement("span",{className:"additionalInfoText annotation"},React.createElement(t.HighlightedText,{text:u})),React.createElement("div",{className:"additionalCallout"},r.additionalCalloutIcon&&React.createElement(t.Icon,{additionalCssClass:"additionalCalloutIcon",icon:r.additionalCalloutIcon}),r.additionalCalloutText&&React.createElement("span",{className:"additionalCalloutText"},r.additionalCalloutText)))),r.additionalSubText&&React.createElement("ul",{className:"additionalSubText"},r.additionalSubText.map(n=>React.createElement("li",{key:n,className:"subText"},n))),!u&&r.additionalCalloutIcon&&React.createElement(t.Icon,{additionalCssClass:"additionalCalloutIcon",icon:r.additionalCalloutIcon,"data-partnertag":t.whenTestHooks("AutoSuggest.AdditionalCalloutIcon")}),!u&&r.additionalCalloutText&&React.createElement("div",{className:"additionalCalloutText","data-partnertag":t.whenTestHooks("AutoSuggest.AdditionalCalloutText")},r.additionalCalloutText)),o&&React.createElement(t.RemoveIcon,{icon:r.removeIcon}))}})(t=n.View||(n.View={}))}(WSB||(WSB={})),function(n){var t;(function(t){class i extends React.Component{constructor(t){super(t);this.shouldComponentUpdate=(t,i)=>!n.config.re   _extra = extra

          return headers
        },
      })

      const fakeAuth0Client = {
        getTokenSilently: async () => 'fakeToken',
      }

      const doRequest = async () => {
        const abortController = new AbortController()
        return baseQuery(
          { url: '/echo' },
          {
            signal: abortController.signal,
            abort: (reason) =>
              // @ts-ignore
              abortController.abort(reason),
            dispatch: storeRef.store.dispatch,
            getState: storeRef.store.getState,
            extra: fakeAuth0Client,
            type: 'query',
            forced: true,
            endpoint: 'someEndpointName',
          },
          {},
        )
      }

      await doRequest()

      expect(_getState).toBeDefined()
      expect(_endpoint).toBe('someEndpointName')
      expect(_type).toBe('query')
      expect(_forced).toBe(true)
      expect(_extra).toBe(fakeAuth0Client)
    })
  })

  test('can pass `headers` into `fetchBaseQuery`', async () => {
    let request: any

    const token = 'accessToken'

    const _baseQuery = fetchBaseQuery({
      baseUrl,
      headers: { authorization: `Bearer ${token}` },
    })

    const doRequest = async () =>
      _baseQuery({ url: '/echo' }, commonBaseQueryApi, {})

    ;({ data: request } = await doRequest())

    expect(request.headers['authorization']).toBe(`Bearer ${token}`)
  })

  test('lets a header be undefined', async () => {
    let request: any
    ;({ data: request } = await baseQuery(
      { url: '/echo', headers: undefined },
      commonBaseQueryApi,
      {},
    ))

    expect(request.headers['fake']).toBe(defaultHeaders['fake'])
    expect(request.headers['delete']).toBe(defaultHeaders['delete'])
    expect(request.headers['delete2']).toBe(defaultHeaders['delete2'])
  })

  test('allows for possibly undefined header key/values', async () => {
    const banana = '1' as '1' | undefined
    let request: any
    ;({ data: request } = await baseQuery(
      { url: '/echo', headers: { banana } },
      commonBaseQueryApi,
      {},
    ))

    expect(request.headers['banana']).toBe('1')
    expect(request.headers['fake']).toBe(defaultHeaders['fake'])
    expect(request.headers['delete']).toBe(defaultHeaders['delete'])
    expect(request.headers['delete2']).toBe(defaultHeaders['delete2'])
  })

  test('strips undefined values from the headers', async () => {
    const banana = undefined as '1' | undefined
    let request: any
    ;({ data: request } = await baseQuery(
      { url: '/echo', headers: { banana } },
      commonBaseQueryApi,
      {},
    ))

    expect(request.headers['banana']).toBeUndefined()
    expect(request.headers['fake']).toBe(defaultHeaders['fake'])
    expect(request.headers['delete']).toBe(defaultHeaders['delete'])
    expect(request.headers['delete2']).toBe(defaultHeaders['delete2'])
  })

  describe('Accepts global arguments', () => {
    test('Global responseHandler', async () => {
      server.use(
        http.get(
          'https://example.com/success',
          () => HttpResponse.text(`this is not json!`),
          { once: true },
        ),
      )

      const globalizedBaseQuery = fetchBaseQuery({
        baseUrl,
        fetchFn: fetchFn as any,
        responseHandler: 'text',
      })

      const req = globalizedBaseQuery(
        { url: '/success' },
        commonBaseQueryApi,
        {},
      )
      expect(req).toBeInstanceOf(Promise)
      const res = await req
      expect(res).toBeInstanceOf(Object)
      expect(res.meta?.request).toBeInstanceOf(Request)
      expect(res.meta?.response).toBeInstanceOf(Object)
      expect(res.error).toBeUndefined()
      expect(res.data).toEqual(`this is not json!`)
    })

    test('Global validateStatus', async () => {
      const globalizedBaseQuery = fetchBaseQuery({
        baseUrl,
        fetchFn: fetchFn as any,
        validateStatus: (response, body) =>
          response.status === 200 && body.success === false ? false : true,
      })

      // This is a scenario where an API may always return a 200, but indicates there is an error when success = false
      const res = await globalizedBaseQuery(
        {
          url: '/nonstandard-error',
        },
        commonBaseQueryApi,
        {},
      )

      expect(res.error).toEqual({
        status: 200,
        data: {
          success: false,
          message: 'This returns a 200 but is really an error',
        },
      })
    })

    test('Global timeout', async () => {
      server.use(
        http.get(
          'https://example.com/empty1',
          async ({ request, cookies, params, requestId }) => {
            await delay(300)

            return HttpResponse.json({
              ...request,
              cookies,
              params,
              requestId,
              url: new URL(request.url),
              headers: headersToObject(request.headers),
            })
          },
          { once: true },
        ),
      )

      const globalizedBaseQuery = fetchBaseQuery({
        baseUrl,
        fetchFn: fetchFn as any,
        timeout: 200,
      })

      const result = await globalizedBaseQuery(
        { url: '/empty1' },
        commonBaseQueryApi,
        {},
      )

      expect(result?.error).toEqual({
        status: 'TIMEOUT_ERROR',
        error: expect.stringMatching(/^AbortError:/),
      })
    })
  })
})

describe('fetchFn', () => {
  test('accepts a custom fetchFn', async () => {
    const baseUrl = 'https://example.com'
    const params = new URLSearchParams({ apple: 'fruit' })

    const baseQuery = fetchBaseQuery({
      baseUrl,
      fetchFn: nodeFetch as any,
    })
    let request: any
    ;({ data: request } = await baseQuery(
      { url: '/echo', params },
      commonBaseQueryApi,
      {},
    ))

    expect(request.url).toEqual(`${baseUrl}/echo?apple=fruit`)
  })

  test('respects mocking window.fetch after a fetch base query is created', async () => {
    const baseUrl = 'https://example.com'
    const baseQuery = fetchBaseQuery({ baseUrl })

    const fakeResponse = {
      ok: true,
      status: 200,
      text: async () => `{ "url": "mock-return-url" }`,
      clone: () => fakeResponse,
    }

    const spiedFetch = vi.spyOn(window, 'fetch')
    spiedFetch.mockResolvedValueOnce(fakeResponse as any)

    const { data } = await baseQuery({ url: '/echo' }, commonBaseQueryApi, {})
    expect(data).toEqual({ url: 'mock-return-url' })

    spiedFetch.mockClear()
  })
})

describe('FormData', () => {
  test('sets the right headers when sending FormData', async () => {
    const body = new FormData()

    body.append('username', 'test')

    body.append(
      'file',
      new Blob([JSON.stringify({ hello: 'there' }, null, 2)], {
        type: 'application/json',
      }),
    )

    const res = await baseQuery(
      { url: '/echo', method: 'POST', body },
      commonBaseQueryApi,
      {},
    )

    const request: any = res.data

    expect(request.headers['content-type']).not.toContain('application/json')
  })
})

describe('still throws on completely unexpected errors', () => {
  test('', async () => {
    const error = new Error('some unexpected error')
    const req = baseQuery(
      {
        url: '/success',
        validateStatus() {
          throw error
        },
      },
      commonBaseQueryApi,
      {},
    )
    expect(req).toBeInstanceOf(Promise)
    await expect(req).rejects.toBe(error)
  })
})

describe('timeout', () => {
  test('throws a timeout error when a request takes longer than specified timeout duration', async () => {
    server.use(
      http.get(
        'https://example.com/empty2',
        async ({ request, cookies, params, requestId }) => {
          await delay(300)

          return HttpResponse.json({
            ...request,
            url: new URL(request.url),
            cookies,
            params,
            requestId,
            headers: headersToObject(request.headers),
          })
        },
        { once: true },
      ),
    )

    const result = await baseQuery(
      { url: '/empty2', timeout: 200 },
      commonBaseQueryApi,
      {},
    )

    expect(result?.error).toEqual({
      status: 'TIMEOUT_ERROR',
      error: expect.stringMatching(/^AbortError:/),
    })
  })
})
