var WSB;(function(n){function u(t,r,u,f,e,o,s,h){i(t,r,u,t=>{var i=null;t.status==200&&(i=t.responseText?n.safeExecute(()=>JSON.parse(t.responseText),"JSON.parse"):{success:!0});f(i)},e,o,s,h)}function i(i,r,u,f,e,o,s,h,c,l,a){let v=c&&_w.XMLHttpRequest?new XMLHttpRequest:sj_gx();const p=l!==null&&l!==void 0?l:u?"POST":"GET";try{v.open(p,i,!0)}catch(w){SharedLogHelper.LogError("fetchUrl",i,w);f&&f({responseText:"",contentType:"",status:-1,result:3});return}if(r)for(let n in r)v.setRequestHeader(n,r[n]);let y;e&&(y=e.register(()=>v.abort(),!1,"xhr abort"));n.config.useEventListeners?(v.addEventListener("load",()=>{t(v,0,f,y,e,o,a)}),v.addEventListener("timeout",()=>{t(v,1,f,y,e,o,a)}),v.addEventListener("abort",()=>{t(v,2,f,y,e,o,a)}),v.addEventListener("error",()=>{t(v,3,f,y,e,o,a)})):(v.onreadystatechange=()=>{v.readyState==4&&v.status>0&&t(v,0,f,y,e,o,a)},v.ontimeout=()=>t(v,1,f,y,e,o,a),v.onabort=()=>t(v,2,f,y,e,o,a),v.onerror=()=>t(v,3,f,y,e,o,a));typeof s!="undefined"?v.withCredentials=s:v.withCredentials!==undefined&&(v.withCredentials=!0);h&&h>0&&(v.timeout=h);v.send(u)}function t(n,t,i,r,u,f,e){if(!f||f()){n.readyState==4&&(n.onreadystatechange=function(){});r&&u.unregister(r);let f={};e&&e.map(t=>f[t]=n.getResponseHeader(t));i&&i({responseText:n.responseText,contentType:n.getResponseHeader("content-type")||"",status:n.status,result:t,responseURL:n.responseURL,responseHeaders:f})}}function e(n){let t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}n.fetchUrlJson=u;n.fetchUrl=i;class r{constructor(t){this._dataSource=t;this._delay=n.config.webDataSourcesWithThrottling[t]||0;this._timers=[]}getBaseUrl(){throw new Error("Not Implemented");}getPostBody(){return undefined}onBeforeFetchUrl(){}createUrl(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")}addParamsToUrl(n,t){let i=t?Object.keys(t):[];return i.length>0&&(n+=n.includes("?")?"&":"?",n+=i.map(n=>n+"="+t[n]).join("&")),n}fetch(t,i,r,u,f,e,o,s,h,c){if(n.isDataSourceEnabled(this._dataSource,t)){let l=this.addParamsToUrl(this.createUrl(t),e),a=this.getPostBody(t)||"";if(this._lastSequenceNumber!=r){for(let n of this._timers)sb_ct(n);this._timers=[];this._lastSequenceNumber=r}if(this._delay>0&&!t.isFormulatedQuery)this._timers.push(n.safeSetTimeout(()=>{this.onBeforeFetchUrl(r,l);this.fetchUrl(l,o,a,i,u,f,s,h,c)},this._delay,"fetchDelay"));else{this.onBeforeFetchUrl(r,l);this.fetchUrl(l,o,a,i,u,f,s,h,c)}}}fetchUrl(t,r,u,f,e,o,s,h,c){i(t,r,u,({responseText:r,contentType:i,status:u})=>{let e;u==200&&(n.TestHookUrlParameters&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&i.includes("json")&&(e=n.safeExecute(()=>JSON.parse(r),"parseWebProviderResponse",null,t)));f(this._dataSource,e,u==200?null:u.toString())},this._delay>0?e:null,o,h,s,c)}}n.JsonDataProvider=r;class f extends r{getName(){return"AsSuggestionsDataProvider"}constructor(t){super("Web");this._responseCacheManager=t;this.asBaseUrl=n.config.u;n.config.enableOfflineWithWeb&&n.config.webHost&&n.isBrowserOnline()&&(this.asBaseUrl=n.config.webHost+this.asBaseUrl)}setBaseUrl(n){this.asBaseUrl=n}getBaseUrl(){return this.asBaseUrl}onBeforeFetchUrl(t,i){n.InstrumentationHelper.instrumentSnRProviderFetchUrl(t,i)}fetch(t,i,r,u,f,e,o){if(n.isDataSourceEnabled(this._dataSource,t)){let s=i;if(s=(r,u,f,e)=>{u&&n.isEmptyUrlPrefix(t)&&(u.Suggestions=[]),this.processResourceResponse(u),i(r,u,f,e)},n.config.enableSearchHistoryMru&&(t===null||t===void 0?void 0:t.isSearchHomeZI)){let i=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();if(i===2&&(o["X-Search-RPSToken"]===undefined||o["X-Search-RPSToken"]===null||o["X-Search-RPSToken"].length===0)){s("Web",null,null,0);return}this.fetchAndCacheSearchHistory(t,s,r,u,e,o);return}this._responseCacheManager?this.fetchWithCache(t,s,r,u,f,e,o):super.fetch(t,s,r,u,f,e,o)}}fetchAndCacheSearchHistory(t,i,r,u,f,e){i("Web",null,null,0);let s=this.addParamsToUrl(this.createUrl(t),f!==null&&f!==void 0?f:{});this.onBeforeFetchUrl(r,s);let h=()=>!0,o=i;o=(i,r,u)=>{try{if(!t.queryToFetch&&this.mruResponseIsValidForCaching(u,r)){r.ELToken&&(r=Object.assign({},r),delete r.ELToken);let t={cacheTime:Math.round((new Date).getTime()/1e3),response:r},i=n.getHistoryCacheKeyForSelectedAccount();n.LightweightStorage.setItem(i,JSON.stringify(t))}}catch(f){SharedLogHelper.LogError("writeCacheFailedWeb",f,new Error("Web Provider write to local cache failed"))}};super.fetch(t,o,r,u,h,f,e)}fetchWithCache(t,i,r,u,f,e,o){let s=this._responseCacheManager.get(t);if(s){let h=this.addParamsToUrl(this.createUrl(t),e);this.onBeforeFetchUrl(r,h);if(i(this._dataSource,s,null,1),n.config.forceUseNifQF&&this._dataSource=="Web"){let s=n.deepCopy(e);s.wsbnoas="1";this.fetchWithoutCache(t,i,r,u,f,s,o)}}else{let s=()=>!0,n=i;n=(n,r,u)=>{f()&&i(n,r,u,0),t.queryToFetch&&this.responseIsValidForCaching(u,r)&&(r.ELToken&&(r=Object.assign({},r),delete r.ELToken),this._responseCacheManager.put(t,r))};super.fetch(t,n,r,u,s,e,o)}}fetchWithoutCache(n,t,i,r,u,f,e){let s=()=>!0,o=t;o=(n,i,r)=>{u()&&t(n,i,r,0)};super.fetch(n,o,i,r,s,f,e)}responseIsValidForCaching(n,t){const i="HS";return!n&&t&&t.Suggestions.every(n=>!n.InstantAnswer&&n.Attributes.stype!=i)}mruResponseIsValidForCaching(n,t){return!n&&t&&t.Suggestions&&t.Suggestions.length>0&&t.Suggestions.every(n=>!n.InstantAnswer)}processResourceResponse(n){if(n){let t=n.Resources;if(t){this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles;let i={Styles:t.Styles,Scripts:null};JsonInject.WriteHeadAndBeforeContentResources(i)}}}updateWithDownloadedResources(n){for(let t in n.Styles)for(let i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]}}n.AsSuggestionsDataProvider=f;n.getIconFromOnlineResponse=e})(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(t){function e(n,t,r,u,f){typeof indexedDB!="undefined"&&new i(n,f,t,r,u)}function o(n,t,r,u,f){typeof indexedDB!="undefined"&&new i(n,f,t,r,u)}function s(n,t,r,u,f,e){typeof indexedDB!="undefined"&&new i(n,e,t,r,u,f)}function h(n,t,r,u,f,e){typeof indexedDB!="undefined"&&new i(n,e,t,r,u,f)}function c(n,t,i){r(n,"deleteDatabase requested");try{let f=indexedDB.deleteDatabase(n);f.onsuccess=()=>{r(n,"deleteDatabase completed"),t&&t()};f.onerror=u("deleteDatabase.onError",t=>{SharedLogHelper.LogError("deleteDB",n,t),i&&i(t)})}catch(f){i&&i(f)}}function u(n,t){return i=>{let r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}const f=100;t.instanceWithNumberKeys=e;t.instanceWithStringKeys=o;t.instanceWithNumberKeysAndSecondaryKey=s;t.instanceWithStringKeysAndSecondaryKey=h;let r=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dbTrace)?(t,i)=>n.log("["+t+"] "+i):()=>{};t.deleteDatabase=c;t.handleErrorEvent=u;class i{constructor(n,t,f,e,o,s){this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";r(this._databaseName,"open requested");let h;try{h=indexedDB.open(n,t||1)}catch(c){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}h.onsuccess=n=>{this._database=n.target.result,i._allInstances.push(this),r(this._databaseName,"open completed"),f(this)};h.onupgradeneeded=n=>{r(this._databaseName,"upgrading");let t=n.target.result;t.objectStoreNames.contains(this._storeName)&&t.deleteObjectStore(this._storeName);let i=t.createObjectStore(this._storeName);this._secondaryIndex&&i.createIndex(this._secondaryIndex,this._secondaryIndex,{unique:!1})};h.onerror=u("open.onError",e);h.onblocked=u("open.onBlocked",e)}put(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,(i,r,u)=>{let f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)}putMultiple(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,(t,i,r)=>{let u=0,f=()=>{if(u<n.length){let e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)}getValue(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",n=>t(n.target.result),(t,i,r)=>{let u=t.get(n);u.onsuccess=i;u.onerror=r},i)}getRange(n,t,i,r){this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,(i,r,u)=>{let f=IDBKeyRange.bound(n,t,!1,!0);this.queryFromCursor(i.openCursor(f),r,u)},r)}getRangeOnSecondaryKey(n,t,i,r){this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,(i,r,u)=>{let f=i.index(this._secondaryIndex),e=IDBKeyRange.bound(n,t,!1,!0);this.queryFromCursor(f.openCursor(e),r,u)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))}removeRange(n,t,i,r){this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,(i,r,u)=>{let f=IDBKeyRange.bound(n,t,!1,!0);this.removeFromCursor(i.openCursor(f),r,u)},r)}removeRangeOnSecondaryKey(n,t,i,r){this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,(i,r,u)=>{let f=i.index(this._secondaryIndex),e=IDBKeyRange.bound(n,t,!1,!0);this.removeFromCursor(f.openCursor(e),r,u)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))}getAll(n,t){this.safeDbOperation("getAll",null,"readonly",n,(n,t,i)=>this.queryFromCursor(n.openCursor(),t,i),t)}close(){r(this._databaseName,"close requested");this.innerClose()}innerClose(){if(i._requestsInProgress>0)r(this._databaseName,"delaying close because of "+i._requestsInProgress+" requests in progress"),this._closePending=!0;else for(let t of i._allInstances)t._database&&(n.safeExecute(()=>t._database.close(),this._databaseName+".close"),r(t._databaseName,"close completed"),t._database=null,t.onClosed())}queryFromCursor(n,t,i){let r=[];n.onsuccess=n=>{let i=n.target.result;i&&r.push({key:i.primaryKey,value:i.value});i&&r.length!=f?i.continue():t(r)};n.onerror=i}removeFromCursor(n,t,i){let r=0;n.onsuccess=n=>{let i=n.target.result;i&&(i.delete(),r+=1);i&&r!=f?i.continue():t(null)};n.onerror=i}safeDbOperation(n,t,f,e,o,s){r(this._databaseName,n+" requested"+(t?" "+t:""));i._requestsInProgress+=1;let c=u=>{r(this._databaseName,n+" completed "+(t?t+" ":"")),i._requestsInProgress-=1,e(u),this._closePending&&i._requestsInProgress==0&&this.innerClose()},h=n=>{i._requestsInProgress-=1,s(n),this._closePending&&i._requestsInProgress==0&&this.innerClose()};try{if(this._database){let t=this._database.transaction(this._storeName,f).objectStore(this._storeName);o(t,c,u(n+".onError",h))}else h(new Error(n+" Database not initialized"))}catch(l){h(l)}}}i._requestsInProgress=0;i._allInstances=[];n.ClientSideStorage=n.Old.ClientSideStorage})(i=t.ClientSideStorage||(t.ClientSideStorage={}))})(t=n.Old||(n.Old={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){const r=250,u=3;class f{constructor(t,i,r,u,f){this._storageFactory=t;this.createResponse=i;this.dataPopulated=r;this.getDataSourceState=u;this._dataSource=f;this._pendingQueries=[];this._storageOpenInProgress=!1;this._retryCount=0;n.Host&&(n.Host.bindAppVisible(()=>this.initStorage()),n.Host.bindDismissed(()=>this._pendingQueries=[]),n.Host.bindAppHidden(()=>this.teardownStorage()))}onAfterWrite(){if(this._writing=!1,this._pendingWrites.length>0){let n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()}teardownStorage(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,this._storage&&this._storage.close())}initStorage(){!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(n=>{this._storage=n,this._storageOpenInProgress=!1,this._pendingQueries.forEach(n=>n()),this._pendingQueries=[]},n=>{this.onError(n,"open storage");this._storageOpenInProgress=!1;this._pendingQueries.forEach(n=>n());this._pendingQueries=[]},()=>this._storage=null))}static getUnixTime(t){return t||(t=n.getCurrentDate()),Math.round(t.getTime()/1e3)}onError(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()}reloadStorage(){this.teardownStorage();this.initStorage()}isReady(){return!!this._storage}getTimeout(t,i){return!t||(i===null||i===void 0?void 0:i.isSearchHomeZI)?n.LatencyTimeout:r}getKey(t,i,r){let u;return u=this._dataSource=="ANA"?"anaheimData":t.queryToFetch?t.queryToFetch.toLocaleLowerCase():"",(n.config.wsbWithCopilot&&i==n.GroupType.AIFeed||n.config.wsbWithCopilotQF&&r=="CP")&&(u="AIFD"),u}fetch(i,r,u,f,e){let s=n.getCurrentTime();if(n.isDataSourceEnabled(this._dataSource,i)){this._dataSource=="ANA"&&(t.AnaheimDataProvider.InstrumentStringNumber.FTC=1);let o=(t,u)=>{let f=n.getCurrentTime()-s;n.InstrumentationHelper.instrumentPerfEvent(n.SequenceNumberManager.getSequenceNumber(),"Fetch"+this._dataSource,f);let o=u=="R";e()&&r(this._dataSource,this.createResponse(i,t,o),this.getDataSourceState(u))};this.innerQueryStorage(1,this.getKey(i),n=>o(n,"R"),()=>o(null,"E"),()=>o(null,"X"),()=>o(null,"T"),i)}}withStorage(n){return this._storage?(n(this._storage),!0):!1}getMaxKey(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}getStorage(n,t,i,r){this.innerQueryStorage(null,null,t=>n(t),t,i,r)}queryStorage(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)}innerQueryStorage(t,r,f,e,o,s,h){let c=null,l=!1,a=!0,v=()=>{if(a)if(a=!1,this._storage){let n=n=>{(n===null||n===void 0?void 0:n.message)==="NotFoundError"&&(this._retryCount+=1);c&&sb_ct(c);this.onError(n,"query");l||(l=!0,e())};t==0?this._storage.getValue(r,n=>{c&&sb_ct(c),l||(l=!0,f(n))},n):r?this._storage.getRange(r,this.getMaxKey(r),n=>{c&&sb_ct(c),l||(l=!0,f(n))},n):this._storage.getAll(n=>{c&&sb_ct(c),l||(l=!0,f(n))},n)}else c&&sb_ct(c),l||(l=!0,e())};if(this._storage)v();else if(this._retryCount<u)if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(v);else{o();return}else{this._retryCount=0;let t=n.DataProviderDBName[this.getName()];this.onError(new Error("Corrupted "+t+". Will delete and reloading."),"IndexDBCorruption");i.deleteDatabase(t);return}let y=this.getTimeout(r,h);y&&(c=n.safeSetTimeout(()=>{c=null,a=!1,l||(l=!0,s())},y,"innerQueryStorage"))}}i.StorageBasedDataProvider=f})(i=t.ClientSideStorage||(t.ClientSideStorage={}))})(t=n.Old||(n.Old={}))}(WSB||(WSB={})),function(n){class r{constructor(){this.pendingWritingPromises={}}async getItemAsync(n){const t=await this.openDBAsync("get");if(!t||!n)return null;this.pendingWritingPromises.hasOwnProperty(n)&&this.pendingWritingPromises[n]&&await this.pendingWritingPromises[n];const i=new Promise((i,u)=>{const e=t.transaction(r.MRUStoreName,"readonly"),o=e.objectStore(r.MRUStoreName),f=o.get(n);f.onsuccess=()=>{const n=f.result;i(n)};f.onerror=()=>{u(null)}});return await i}async setItemAsync(n,t){const i=await this.openDBAsync("set");if(!i||!n)return!1;try{this.pendingWritingPromises.hasOwnProperty(n)&&this.pendingWritingPromises[n]&&await this.pendingWritingPromises[n];this.pendingWritingPromises[n]=new Promise((u,f)=>{const o=i.transaction(r.MRUStoreName,"readwrite"),s=o.objectStore(r.MRUStoreName),e=s.put(t,n);e.onsuccess=()=>{u(!0)};e.onerror=()=>{f(!1)}});return await this.pendingWritingPromises[n]}finally{delete this.pendingWritingPromises[n]}}async openDBAsync(t){if(r.stat_openDBCallCount++,this.pendingOpeningPromise&&await this.pendingOpeningPromise,this.mruDB)return this.mruDB;r.stat_openDBCount++;r.stat_openDBCaller=t;try{this.pendingOpeningPromise=new Promise((t,i)=>{let u;try{u=indexedDB.open(n.MRUDatabaseName,r.MRUDBVersion);u.onsuccess=()=>{let n=u.result;this.mruDB=n;r.stat_openDBSuccessCount++;t(n)};u.onupgradeneeded=()=>{try{let n=u.result;if(this.mruDB=n,!n.objectStoreNames.contains(r.MRUStoreName)){const t=n.createObjectStore(r.MRUStoreName);t.createIndex(r.SECONDARY_KEY,r.SECONDARY_KEY,{unique:!1})}}catch(n){SharedLogHelper.LogError("PSDbUpgrade",null,n)}};u.onerror=()=>{r.stat_openDBFailureCount++,i(null)};u.onblocked=()=>{i(null)}}catch(f){SharedLogHelper.LogError("PSDbOpen",null,f);this.pendingOpeningPromise=null;i(null)}});const t=await this.pendingOpeningPromise;t&&(this.mruDB=t)}finally{return delete this.pendingOpeningPromise,this.mruDB}}static mkReset(){r.stat_openDBCaller&&r.stat_openDBCallCount&&r.stat_openDBCount>=Number.MAX_SAFE_INTEGER&&r.stat_openDBSuccessCount&&r.stat_openDBFailureCount&&(r.stat_openDBCaller=null,r.stat_openDBCallCount=0,r.stat_openDBCount=0,r.stat_openDBSuccessCount=0,r.stat_openDBFailureCount=0)}}r.MRUDBVersion=1;r.MRUStoreName="mruWithIndexStore";r.SECONDARY_KEY="LastUpdated";r.stat_openDBCallCount=0;r.stat_openDBCount=0;r.stat_openDBSuccessCount=0;r.stat_openDBFailureCount=0;class i{static resetPSCache(){i.HasMRUDbEntriesFirstBackup=!1;i.HasMRUDbEntriesInit=!1;i.HasMRUDbEntriesChange=!1;i.HasMRUSearchHistoryCacheChange=!1;i.HasMRUDismissCacheChange=!1;i.HasSelectedAccountIdChange=!1}static setMRUDbEntries(n){t.SetMRUBackfillSignalDone&&(i.HasMRUDbEntriesInit=!0,i.MRUDbEntries=n||[])}static changeMRUDbEntries(n,r){if(t.SetMRUBackfillSignalDone){let u=i.MRUDbEntries;if(u&&i.HasMRUDbEntriesInit){let t=u.findIndex(t=>t.key==n);t!=-1?u[t].value=r:u.push({key:n,value:r});i.HasMRUDbEntriesChange=!0}}}static changeSearchHistoryCache(n){t.SetMRUBackfillSignalDone&&i.MRUSearchHistoryCache!=n&&(i.MRUSearchHistoryCache=n,i.HasMRUSearchHistoryCacheChange=!0)}static changeMRUDismissCache(n){t.SetMRUBackfillSignalDone&&i.MRUDismissCache!=n&&(i.MRUDismissCache=n,i.HasMRUDismissCacheChange=!0)}static changeSelectedAccountId(n){t.SetMRUBackfillSignalDone&&i.SelectedAccountId!=n&&(i.SelectedAccountId=n,i.HasSelectedAccountIdChange=!0)}}i.HasMRUDbEntriesFirstBackup=!1;i.HasMRUDbEntriesInit=!1;i.HasMRUDbEntriesChange=!1;i.HasMRUSearchHistoryCacheChange=!1;i.HasMRUDismissCacheChange=!1;i.HasSelectedAccountIdChange=!1;n.PSCache=i;class t{static resetPSManager(){t.mruIndexedDB=new r;i.resetPSCache();t.SetMRUBackfillSignalDone=!1;t.stat_backfillInProgress=!1;t.stat_backupInProgress=!1;t.stat_clearInProgress=!1;t.stat_backfillCaller&&t.stat_backfillCallCount&&t.stat_backfillCount>=Number.MAX_SAFE_INTEGER&&t.stat_backfillSuccessCount&&t.stat_backfillFailureCount&&t.stat_backfillInst&&(t.stat_backfillCaller=null,t.stat_backfillCallCount=0,t.stat_backfillCount=0,t.stat_backfillSuccessCount=0,t.stat_backfillFailureCount=0,t.stat_backfillInst={});t.stat_backupCaller&&t.stat_backupCallCount&&t.stat_backupCount>=Number.MAX_SAFE_INTEGER&&t.stat_backupSuccessCount&&t.stat_backupFailureCount&&(t.stat_backupCaller=null,t.stat_backupCallCount=0,t.stat_backupCount=0,t.stat_backupSuccessCount=0,t.stat_backupFailureCount=0);t.stat_clearCaller&&t.stat_clearCallCount&&t.stat_clearCount>=Number.MAX_SAFE_INTEGER&&t.stat_clearSuccessCount&&t.stat_clearFailureCount&&(t.stat_clearCaller=null,t.stat_clearCallCount=0,t.stat_clearCount=0,t.stat_clearSuccessCount=0,t.stat_clearFailureCount=0);r.mkReset()}static isPSFeatureEnabled(i){return(n.config.bypassPSTestEnvCheck||!t.isTestEnvironment())&&n.config.enablePersistentStorageCarryover&&i=="MRU"&&n.VelocityKeys.getFeatureStatus(50659858)!="0"}static isTestEnvironment(){return n.TestHookUrlParameters||n.MockUrlParameters?!0:!1}static async checkAndBackfillMRUAtBootstrapAsync(i="init"){if((t.stat_backfillCallCount++,t.SetMRUBackfillSignalDone&&!n.config.alwaysReadPersistentStorageForTest)||t.stat_backfillInProgress)return!0;t.stat_backfillInProgress=!0;t.stat_backfillCount++;t.stat_backfillCaller=i;const f=performance.now(),r={},e=await t.checkMRUBackfillKeyAsync(r);let u=!0;return(!e||n.config.alwaysReadPersistentStorageForTest)&&(t.backfillLocalStorage(r),u=await t.backfillIndexedDBAsync(r),r.PSBFL=performance.now()-f,t.uploadInst("PSBackfill",r)),t.stat_backfillInst=r,t.SetMRUBackfillSignalDone=await t.setMRUBackfillSignalAsync(),t.stat_backfillInProgress=!1,u?t.stat_backfillSuccessCount++:t.stat_backfillFailureCount++,u}static checkAndBackupMRUAtDismiss(r){if(t.stat_backupCallCount++,!t.SetMRUBackfillSignalDone)return!1;if(t.stat_backupInProgress)return!0;t.stat_backupInProgress=!0;t.stat_backupCount++;t.stat_backupCaller=r;const e=performance.now();t.stat_backupCount++;let u=[];if((!i.HasMRUDbEntriesFirstBackup||i.HasMRUDbEntriesChange||n.config.alwaysWritePersistentStorageForTest)&&i.HasMRUDbEntriesInit){const n=t.serializeMRUEntries(i.MRUDbEntries);u=u.concat(n);i.HasMRUDbEntriesFirstBackup=!0;i.HasMRUDbEntriesChange=!1}if(i.HasMRUSearchHistoryCacheChange){const n=t.getSHCachePSKVPs(i.MRUSearchHistoryCache);u=u.concat(n);i.HasMRUSearchHistoryCacheChange=!1}i.HasMRUDismissCacheChange&&(u.push({key:n.config.mruWsDismissCacheKey,value:i.MRUDismissCache||""}),i.HasMRUDismissCacheChange=!1);i.HasSelectedAccountIdChange&&(u.push({key:n.SelectedAccountIdStorageKey,value:i.SelectedAccountId||""}),i.HasSelectedAccountIdChange=!1);let f=!0;if(u.length>0){const n={};f=t.backupPersistentStorage(u,n);n.PSBUL=performance.now()-e;t.uploadInst("PSBackup",n)}return t.stat_backupInProgress=!1,f?t.stat_backupSuccessCount++:t.stat_backupFailureCount++,f}static async clearMRUAtButtonClickedAsync(n){if(t.stat_clearCallCount++,t.stat_clearInProgress)return!0;t.stat_clearInProgress=!0;t.stat_clearCount++;t.stat_clearCaller=n;const o=performance.now();i.setMRUDbEntries([]);t.SetMRUBackfillSignalDone=await t.setMRUBackfillSignalAsync();let f=0,u=0;const s=performance.now();for(const n of t.MRUPSKeys){const t=SearchAppWrapper.CortanaApp.persistentStorage.removeItem(n);t?f++:u++}const e=performance.now()-s,r={};return r.PSCRL=performance.now()-o,r.PSRTL=e,r.PSRKL=e/t.MRUPSKeys.length,r.PSRSC=f,r.PSRFC=u,t.uploadInst("PSClear",r),t.stat_clearInProgress=!1,u==0?t.stat_clearSuccessCount++:t.stat_clearFailureCount++,u==0}static async checkMRUBackfillKeyAsync(n){const r=performance.now(),i=await t.mruIndexedDB.getItemAsync(t.MRUBackfillSignalKey);return n.DBGKL=performance.now()-r,n.DBGRC=i?1:0,i?!0:!1}static backfillLocalStorage(i){const e=performance.now(),r=SearchAppWrapper.CortanaApp.persistentStorage.getItems(t.CacheKeys),u=performance.now()-e;let f=0;if(r)for(const t in r)if(r.hasOwnProperty(t)){const i=r[t];i&&(f++,n.LightweightStorage.setItem(t,i))}i.PSGTL2=u;i.PSGKL2=u/t.CacheKeys.length;i.PSGKC2=t.CacheKeys.length;i.PSGRC2=f;t.backfillLocalStorageWithSearchHistoryCache(i)}static backfillLocalStorageWithSearchHistoryCache(i){const e=performance.now(),r=SearchAppWrapper.CortanaApp.persistentStorage.getItems(t.SHCachePSKeys),u=performance.now()-e;let f=0;if(r){let i="";for(const n in t.SHCachePSKeys)if(r.hasOwnProperty(n)){const t=r[n];t&&(f++,i=i.concat(t))}i&&n.LightweightStorage.setItem(n.config.mruAsSearchHistoryCacheKey,i)}i.PSGTL3=u;i.PSGKL3=u/t.CacheKeys.length;i.PSGKC3=t.CacheKeys.length;i.PSGRC3=f}static async backfillIndexedDBAsync(n){const e=performance.now(),i=SearchAppWrapper.CortanaApp.persistentStorage.getItems(t.MRUPSKeys),u=performance.now()-e;let r=!0,f=0;if(i)for(const n in i)if(i.hasOwnProperty(n)){const u=i[n];if(u){f++;try{let n=JSON.parse(u);n&&n.key&&n.value&&(r=r&&await t.mruIndexedDB.setItemAsync(n.key,n.value))}catch(e){SharedLogHelper.LogError("PSBFDB",null,e);r=!1}}}return n.PSGTL=u,n.PSGKL=u/t.MRUPSKeys.length,n.PSGKC=t.MRUPSKeys.length,n.PSGRC=f,r}static async setMRUBackfillSignalAsync(){return await t.mruIndexedDB.setItemAsync(t.MRUBackfillSignalKey,t.MRUBackfillSignalValue)}static serializeMRUEntries(n){let r=[],i=0;for(const u of n){if(i>=t.MaxMRUBackkfillCount)break;if(u&&u.key&&u.value){if(u.key===t.MRUBackfillSignalKey)continue;try{r.push({key:t.MRUPSKeys[i],value:JSON.stringify(u)});i++}catch(f){}}}while(i<t.MaxMRUBackkfillCount)r.push({key:t.MRUPSKeys[i],value:""}),i++;return r}static backupPersistentStorage(n,i){let u=0,r=0;if(n&&n.length>0){const f=new Date;f.setDate(f.getDate()+t.MruMaxAgeInDays);const o=performance.now();for(const t of n){const n=SearchAppWrapper.CortanaApp.persistentStorage.setItem(t.key,t.value,f);n?u++:r++}const e=performance.now()-o;i.PSSTL=e;i.PSSKL=e/n.length;i.PSSSC=u;i.PSSFC=r}return r==0}static getSHCachePSKVPs(n){let i=[];if(n&&n.length<=t.MaxSHCacheStringLength)for(let r=0;r<t.MaxSHCachePSCount;r++){let u=r*t.MaxSHCachePSValueLength;if(n.length>u){let f=Math.min((r+1)*t.MaxSHCachePSValueLength,n.length);i.push({key:t.SHCachePSKeys[r],value:n.substring(u,f)||""})}else i.push({key:t.SHCachePSKeys[r],value:""})}else for(let n=0;n<t.MaxSHCachePSCount;n++)i.push({key:t.SHCachePSKeys[n],value:""});return i}static getSHCacheKey(t){return`${n.config.mruAsSearchHistoryCacheKey}_${t}`}static getMRUPSKey(n){return`MRU_${n}`}static getUnixTime(t){return t||(t=n.getCurrentDate()),Math.round(t.getTime()/1e3)}static uploadInst(t,i){try{let r=_G.IG;if(!r){SharedLogHelper.LogError("uploadInst "+t,"Could not instrument as server IG not known");return}let u=n.InstrumentationCommon.createPerfPingEvent(r,[i],t);n.InstrumentationHelper.logPerfPingEvent(u)}catch(r){typeof SharedLogHelper!="undefined"&&SharedLogHelper.LogError("uploadInstError",t,r)}}}t.MRUBackfillSignalKey="MRUBackfillSignal";t.SetMRUBackfillSignalDone=!1;t.MruMaxAgeInDays=30;t.MRUBackfillSignalValue={LastUpdated:t.getUnixTime(),SuggestionEngagementData:{}};t.MaxMRUBackkfillCount=20;t.MRUPSKeys=Array.from({length:t.MaxMRUBackkfillCount},(n,i)=>t.getMRUPSKey(i+1));t.MaxSHCachePSCount=3;t.SHCachePSKeys=Array.from({length:t.MaxSHCachePSCount},(n,i)=>t.getSHCacheKey(i+1));t.MaxSHCachePSValueLength=3999;t.MaxSHCacheStringLength=t.MaxSHCachePSCount*t.MaxSHCachePSValueLength;t.CacheKeys=[n.config.mruWsDismissCacheKey,n.SelectedAccountIdStorageKey];t.mruIndexedDB=new r;t.stat_backfillInProgress=!1;t.stat_backupInProgress=!1;t.stat_clearInProgress=!1;t.stat_backfillCallCount=0;t.stat_backfillCount=0;t.stat_backfillSuccessCount=0;t.stat_backfillFailureCount=0;t.stat_backupCallCount=0;t.stat_backupCount=0;t.stat_backupSuccessCount=0;t.stat_backupFailureCount=0;t.stat_clearCallCount=0;t.stat_clearCount=0;t.stat_clearSuccessCount=0;t.stat_clearFailureCount=0;t.stat_backfillInst={};n.PSManager=t}(WSB||(WSB={})),function(n){const t=3;class i{constructor(n,t,i,r=null){this._navigationHelper=n;this._temporaryMessageHandler=t;this.dataSource=i;this._copilotViewModel=r}parse(i,r,u,f,e,o,s){let h=[],a=[],v=[],y=[],p=[],w=[],b=[],c=[],k=[],l=[];if(f&&f.Suggestions)for(let e of f.Suggestions){let f=e.suggestionData;if(f.handoffType==2){let t=f;n.isApp(f.type)?(a.push(t.id),p.push(e)):n.isSetting(f.type)?(v.push(t.id),w.push(e)):n.isFileOrFolder(f.type)&&(y.push(t.id),b.push(e))}else if(f.handoffType==25||n.config.wsbWithCopilotQF&&f.type=="CP"){let n=this.parseMRUAIFeedSuggestion(i,e,r);k.push(n)}else if(n.isBingEnabled()){if(n.config.msbMruLimitEnabled&&u==="MWS"&&i.scope===n.Scope.All&&h.length===t)break;let o=n.safeExecute(()=>this.parseMRUWebSuggestion(i,e,r,u,n.config.enableMruProviderInQF),"parseMRUWebSuggestion");o&&(n.config.enableMruProviderInQF&&(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())===3?i.isSearchHomeZI&&f.handoffType==0?c.push(o):h.push(o):f.handoffType==0?c.push(o):h.push(o))}}if(this.shouldFetchBingSearchHistory(i)&&!n.canShowSearchHomeAIFeed(i)){let n=this.parseASBingSearchHistory(i,r),t=this.dedupeLocalAndMRSASSuggestions(c,n);l=this.filterDismissedSuggestionsForMRSSuggestions(t)}else l=c;n.config.wsbWithCopilot&&l.push(...k);u!="MWS"&&(n.lookupById(i,"MPP",a,p,undefined,null,null,n=>[n.suggestionData.id],"MST",v,w,n=>n.suggestionData.id,e,r,o,s,(n,t,u,f)=>this.parseIdLookupResponse(i,r,n,t,u,f),"MFF",y,b,n=>n.suggestionData.id),n.isDataSourceEnabled("MRS",i)&&o("MRS",l,f));o(u,h,f)}parseIdLookupResponse(t,i,r,u,f,e){let o=r.suggestionData;if((n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.mockMRUDataFile)&&f.length==0){const t={displayName:o.id,id:o.id,kind:"document",getProperty:null,propertyHits:[],rankScore:1e3};f.push(n.createLocalResponseSuggestionWithDeviceItemImage(t,o.type,u))}if(f.length==1){let s=n=>(this.setupRemoveFromHistoryContextMenu(n,r,t),n.lastLaunchTime=r.rankingData.lastLaunchTime,o.appContextData&&(n.appContext=o.appContextData.appContext,n.query=o.appContextData.query,n.text=t.queryToFetch?HitHighlightingParser.addMarkers(o.appContextData.textWithoutHH,t.queryToFetch):o.appContextData.textWithoutHH),this.setRankingSignals(n,o),!0);n.safeExecute(()=>n.parseLocalSuggestion(t,f[0],u,i,this._temporaryMessageHandler,o.type,e,s),"parseLocalSuggestion "+u)}}shouldFetchBingSearchHistory(t){return n.config.enableSearchHistoryMru&&n.isBingEnabled()&&t.isSearchHomeZI&&((n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())==2||n.config.enableSyncedHistoryLocal&&(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())==3)?!0:!1}parseASBingSearchHistory(t,i){var r;let f=[],e=n.getHistoryCacheKeyForSelectedAccount();const u=n.LightweightStorage.getItem(e);if(u){(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&n.PSCache&&n.PSCache.changeSearchHistoryCache(u);const{cacheTime:o,response:e}=JSON.parse(u),s=Math.round((new Date).getTime()/1e3)-o>=86400;s||((r=e===null||e===void 0?void 0:e.Suggestions)===null||r===void 0?void 0:r.forEach(r=>{let u=n.safeExecute(()=>this.parseASMRUWebSuggestion(t,r,i),"parseASMRUWebSuggestion");u&&f.push(u)}))}return f}dedupeLocalAndMRSASSuggestions(n,t){let i=n;for(let n of t){let t=-1;t=i.findIndex(t=>t.query===n.query);t!==-1?i[t].lastLaunchTime<n.lastLaunchTime&&(i[t]=n):i.push(n)}return i}filterDismissedSuggestionsForMRSSuggestions(t){let i=this.loadDismissedMruWebSugFromCache(),r=t;if(!n.isNullOrUndefined(i)&&i.length>0&&!n.isNullOrUndefined(i[0]))for(let t of i){let u=-1;if(u=r.findIndex(n=>n.query===t.query),u!=-1)if(r[u].lastLaunchTime<t.lastDismissedTime)r.splice(u,1);else{let r=i.indexOf(t);i.splice(r,1);n.LightweightStorage.setItem(n.config.mruWsDismissCacheKey,JSON.stringify(i))}}return r}loadDismissedMruWebSugFromCache(){let i=[];const t=n.LightweightStorage.getItem(n.config.mruWsDismissCacheKey);return t&&(n.PSManager&&n.PSCache&&n.PSManager.isPSFeatureEnabled(this.dataSource)&&n.PSCache.changeMRUDismissCache(t),i=JSON.parse(t)),i}updateDismissedMruWebSugCache(t){let r=new Date,i=this.loadDismissedMruWebSugFromCache(),u=i.findIndex(n=>n.query===t.query);u!==-1?i[u].lastDismissedTime=Math.round(r.getTime()/1e3):(i.length>=n.config.dismissedMrsCacheSize&&(i.sort((n,t)=>n.lastDismissedTime-t.lastDismissedTime),i.splice(0,1)),i.push({query:t.query,lastDismissedTime:Math.round(r.getTime()/1e3)}));const f=JSON.stringify(i);n.LightweightStorage.setItem(n.config.mruWsDismissCacheKey,f);(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&n.PSCache&&n.PSCache.changeMRUDismissCache(f)}setRankingSignals(n,t){n.hc=t.hc;n.highConfidenceMetaSuggestionScore=t.highConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.prefetchConfidenceScore;n.fromHistory=!0;n.hasMruData=!0}setRankingSignalsForAsSuggestion(n,t){var i;let r=t.Attributes;n.hc=r.hc==="1";n.suggestionLogMeta=r.lm;n.highConfidenceSuggestionScore=+((i=r.hcs)!==null&&i!==void 0?i:0);n.highConfidenceMetaSuggestionScore=t.HighConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.PrefetchConfidenceScore;n.fromHistory=!0}parseMRUWebSuggestion(t,i,r,u,f){let o=i.suggestionData,e=null;f?(e=n.createWebSuggestion(t,t.queryToFetch?HitHighlightingParser.addMarkers(o.textWithoutHH,t.queryToFetch):o.textWithoutHH,null,o.icon,o.type,o.query,n.InstrumentedItem.createInstrumentedItem(r,o.type),o.handoffType,r,o.mayContainPII,o.subType,o.additionalInfoText,o.primaryMetadata,o.autoOpenPreviewPaneWhenOnTopHit,o.isAnswer,o.previewPaneType,o.secondaryIcon,o.segments,o.narratorText,0,o.childSuggestionsInJsonString),e.allowedInGroups=e.secondaryIcon?!!e.additionalInfoText:!e.htmlContent,e.childSuggestions&&e.childSuggestions.forEach(i=>{i.parent=e,i.sequenceNumber=e.sequenceNumber,i.instItem=n.InstrumentedItem.createInstrumentedItem(r,i.type),i.getMruData=()=>n.getMruWebSuggestionData(i),i.click=()=>n.Host.launchSearchAsync(e.query,this._navigationHelper.getSearchUrl(t.fullPartialQuery,i.query,i.type,null,e.handoffType,"WSQFLH"),e.useRaf,"WSQFLH")})):e=n.createSuggestion(t,t.queryToFetch?HitHighlightingParser.addMarkers(o.textWithoutHH,t.queryToFetch):o.textWithoutHH,null,o.icon,o.type,o.query,n.InstrumentedItem.createInstrumentedItem(r,o.type),o.handoffType,r,!1);e.lastLaunchTime=i.rankingData.lastLaunchTime;e.webUrl=o.webUrl;this.setRankingSignals(e,o);switch(e.handoffType){case 5:case 4:if(!n.isCortanaEnabledCache||e.type=="CSK")return null;let f=o;if(e.primaryMetadata=f.annotation||f.secondaryText,e.reactKey=e.type+e.primaryMetadata,!n.setCat1SuggestionProperties(e,t,r,f.actionUri,f.taskFrame,f.confidence,f.source))return null;break;case 3:case 10:return null;case 0:case 13:case 14:case 21:case 17:if(!(n.isDataSourceEnabled("MRS",t)||n.isDataSourceEnabled("MWS",t)))return null;let c=o;(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkMruEnabled())&&u=="MWS"&&(t.isWorkScopeZI||t.isSearchHomeZI)?n.msbHost.qfUtils.setMsbMruSuggestionProperties(e,o):(!t.isSearchHomeZI||t.scope==n.Scope.Web&&n.config.enableZeroInputSearchHomeWeb&&!n.canEnableDsbWebMruInWebScope(t)||(e=this.setTextAndIconForLBSHSuggestion(e,c)),n.setWebSearchSuggestionProperties(e,t,r,c.url,this._navigationHelper,null,!0));e.reactKey=this.generateReactKey(t,e);break;case 1:let s=o,l=i.rankingData;t.queryToFetch.length>3&&(e.autoOpenPreviewPaneWhenOnTopHit=!!l.previewPaneLaunchCount);let h=s.title||s.secondaryText;t.isSearchHomeZI&&h?(e.additionalInfoText=s.url,e.text=HitHighlightingParser.removeMarkers(h)):e.primaryMetadata=h;e.reactKey=s.type+s.url;n.setUrlSuggestionProperties(e,t,r,s.url);n.config.directNavPreviewPane&&e.type=="MD"&&e.url&&(e.getIcon=n.getFaviconUrlForRawUrl(e.url,64,64,1.5),t.isSearchHomeZI||(e.previewPaneType=2));break;default:return SharedLogHelper.LogError("parseMruWebSuggestion",null,new Error("Unexpected handoff type: "+o.handoffType)),null}return n.isValidSuggestion(e,"parseMruWebSuggestion")?(this.setupRemoveFromHistoryContextMenu(e,i,t),e):null}parseMRUAIFeedSuggestion(t,i,r){let u=i.suggestionData;const e=u.converationId;let f=n.createSuggestion(t,u.text,null,{type:0,className:"codexIcon"},u.type,u.text,n.InstrumentedItem.createInstrumentedItem(r,u.type),25,r,!1,u.suggestionKey,null,!1,u.suggestionKey);return f.converationId=e,f.lastLaunchTime=i.rankingData.lastLaunchTime,f.click=()=>{this._copilotViewModel.fetchConversationHistory(e).then(n=>{(n===null||n===void 0?void 0:n.length)>0&&this._copilotViewModel.renderChat("",e,n)})},f.narratorText=n.getNarratorText(f),this.setupRemoveFromHistoryContextMenu(f,i,t),f}parseASMRUWebSuggestion(t,i,r){var e,o;const u=i.Attributes;if(!u.url)return null;let s;s=u.isAnswer==="1"?u.url||u.vertical?n.verticalToHandoffType(u.vertical):10:n.verticalToHandoffType(u.vertical);let f=n.createSuggestion(t,(e=u.query)!==null&&e!==void 0?e:"",undefined,this.getIconForMRUSearchHistorySuggestion(),u.stype,(o=u.query)!==null&&o!==void 0?o:"",n.InstrumentedItem.createInstrumentedItem(r,u.stype),s,r,!1);if(f.lastLaunchTime=Number(u.llt),f.primaryMetadata=i.SecondaryText,this.setRankingSignalsForAsSuggestion(f,i),n.setWebSearchSuggestionProperties(f,t,r,u.url,this._navigationHelper),f.reactKey=this.generateReactKey(t,f),n.isValidSuggestion(f,"parseMruWebSuggestion")){let t=()=>{this.updateDismissedMruWebSugCache(f),n.Host.refreshCurrentPane()};return n.setExtraVerbs(f,()=>{let i={verb:"RemoveFromDeviceHistoryAll",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:()=>{t()},icon:{content:"&#xE711",type:2}};return[i]},!0),f}return null}setTextAndIconForLBSHSuggestion(n,t){return n.text=t.query,n.icon=this.getIconForMRUSearchHistorySuggestion(),n}getIconForMRUSearchHistorySuggestion(){return n.config.disableMruLBSHColorfulIcon?{type:2,content:"&#xE721"}:{type:0,className:n.config.enableLBSHGradientIcon?"LBSHGradientSpyglass":n.config.enableLBSHSolidBlueIcon?"LBSHSolidBlueSpyglass":n.config.mirrorMruLBSHItemIcon?"LBSHSpyglassSV2":"LBSHSpyglass"}}setupRemoveFromHistoryContextMenu(t,i,r){n.RuntimeConfig.QfMode!=5&&n.RuntimeConfig.QfMode!=9&&i.remove&&n.setExtraVerbs(t,u=>{if(u||!i.remove)return[];if(!t.removeIcon&&t.duplicates&&t.duplicates.some(n=>!n.fromHistory))return[];const f=n.config.mruSearchHome&&((r===null||r===void 0?void 0:r.scope)===n.Scope.All||(r===null||r===void 0?void 0:r.scope)===n.Scope.Work);let e={verb:f?"RemoveFromDeviceHistoryAll":"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:()=>{i.remove(()=>{t.handoffType!==2&&this.updateDismissedMruWebSugCache(t),n.Host.refreshCurrentPane(),f||this._temporaryMessageHandler.showTemporaryMessage(n.Host.getLocString("RemovedFromDeviceHistory",HitHighlightingParser.removeMarkers(t.text)))}),delete i.remove},icon:{content:"&#xE711",type:2}};return[e]},!0)}generateReactKey(t,i){var r;return(t===null||t===void 0?void 0:t.isSearchHomeZI)?n.config.enableFromYourHistory?`${i.type}${"MRS"}${i.text}`:`${"MRS"}${i.text}`:n.config.enableMruProviderInQF?i.type+((r=i.childSuggestions)===null||r===void 0?void 0:r.some)+i.query:i.type+t.fullPartialQuery}}n.MRUParser=i}(WSB||(WSB={})),function(n){var t;(function(t){var i;(function(i){const f=30,e=3,o=8,s=2,h=4,c=n.config.mruImprovement3?50:15,l="LastUpdated",u="MRUNoItemsAvailable";class r extends t.ClientSideStorage.StorageBasedDataProvider{static getMRUInstrumentationStringMap(){return r._instrumentedStrings}getName(){return this.dataSource==="MWS"?"MRUWorkSearchDataProvider":"MRUDataProvider"}constructor(i,r,u,f,e,o,s,h,c,a){i&&(i.bindItemLaunch((n,t,i)=>this.storeSuggestionToMRU(n,t,i)),i.bindConversationEnds((n,t,i)=>this.storeSuggestionToMRU(n,t,i)));let v,y=(t,i,u)=>r(o,i=>{t(i);let r=n.getTimeDiffInDays(v);(r===null||r>=1)&&(v=n.getCurrentDate(),this.prune());this.getStorage(n=>this.instrumentMRUSize(n),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())},i,u,l),p=(t,i,r)=>(n.MockUrlParameters&&!n.MockUrlParameters.mockMRUDataOff&&(i=this.dataSource==="MWS"?n.MockedMSBMRUData:n.MockedMRUData),this.dataSource!=="MWS"||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkMruEnabled())||(i=[]),n.safeExecute(()=>this.createMruResponse(t,i,r),"createMruResponse")),w=()=>!0,b=n=>n=="R"?undefined:n;n.Host.bindClearMRURequested(async i=>{this.teardownStorage(),t.ClientSideStorage.deleteDatabase(o,()=>i(!0),()=>i(!1)),(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&await n.PSManager.clearMRUAtButtonClickedAsync("ClearRequested")},o);super(y,p,w,b,c);this.dataSource=c;this.dmaWebRecentsType=[0,13,14,16,15];n.config.enableMruProviderInQF&&(this._mruInMemoryCache=a);this.candidatesEnabled=s;this.loggingEnabled=h;this.getSuggestionKey=u;this.getGroupType=f;this.isMRUHistoryGroupType=e;this._pendingWrites=[];sj_evt.bind("clearMRUButtonClicked",async()=>{t.ClientSideStorage.deleteDatabase(o),this.reloadStorage(),(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&await n.PSManager.clearMRUAtButtonClickedAsync("ButtonClicked")});(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&(n.Host.bindBootstrapDone(async()=>{(n.config.backfillActionCode==1||n.config.backfillActionCode==11||n.config.backfillActionCode==21)&&await n.PSManager.checkAndBackfillMRUAtBootstrapAsync("BootstrapDone")}),n.Host.bindShown(async()=>{(n.config.backfillActionCode==10||n.config.backfillActionCode==11||n.config.backfillActionCode==12)&&await n.PSManager.checkAndBackfillMRUAtBootstrapAsync(""),n.config.backupActionCode==10&&n.PSManager.checkAndBackupMRUAtDismiss("Shown")}),n.Host.bindDismissed(async()=>{(n.config.backfillActionCode==20||n.config.backfillActionCode==21||n.config.backfillActionCode==22)&&await n.PSManager.checkAndBackfillMRUAtBootstrapAsync("Dismiss"),n.config.backupActionCode==20&&n.PSManager.checkAndBackupMRUAtDismiss("Dismiss")}))}createMruResponse(t,i,r){var l,a,v,y,p;t&&t.isSearchHomeZI&&(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&n.PSCache&&(i&&(i=i.filter(t=>t.key!=n.PSManager.MRUBackfillSignalKey)),n.PSCache.setMRUDbEntries(i));i=i||[];let f=this.getKey(t);this._lastKey=r?f:null;let w=r?i.find(n=>n.key==f):null;this._valueForLastKey=w?w.value:null;let u={};if(this._valueForLastKey&&(u.SuggestionEngagementData=this._valueForLastKey.SuggestionEngagementData),u.LookupCompletions=i.map(n=>({key:n.key,value:n.value.SuggestionEngagementData})),this.candidatesEnabled()){let r=[],v=this.getOldestDateToKeep();for(let{key:t,value:n}of i)if(n.Suggestions)for(let i of n.Suggestions){let u=this.getRankingData(n,i);u&&u.lastLaunchTime&&u.lastLaunchTime>=v&&r.push({rankingData:t==this._lastKey?{prefixLaunchCount:u.prefixLaunchCount,lastLaunchTime:u.lastLaunchTime,previewPaneLaunchCount:u.previewPaneLaunchCount,lastPreviewPaneLaunchTime:u.lastPreviewPaneLaunchTime}:u,suggestionData:i,remove:n=>this.remove(t,i,n)})}if(r.length>0){if(u.Suggestions=[],r.sort((n,t)=>t.rankingData.lastLaunchTime-n.rankingData.lastLaunchTime),r.forEach(n=>this.addToResponseIfNotPresent(u.Suggestions,n)),n.config.enableMruProviderInQF&&this._mruInMemoryCache&&!(t===null||t===void 0?void 0:t.isSearchHomeZI)&&this._mruInMemoryCache.getSize()==0&&u.Suggestions&&(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())===3)for(const t of(l=u.Suggestions)===null||l===void 0?void 0:l.values())if(this._mruInMemoryCache.getSize()<n.config.mruInMemoryCacheSize&&((a=t===null||t===void 0?void 0:t.suggestionData)===null||a===void 0?void 0:a.handoffType)==0){let i=t===null||t===void 0?void 0:t.suggestionData;i&&this._mruInMemoryCache.add(i.query,t,n.config.useLaunchCount,n.config.useLaunchTime)}f?f.length<=e?u.Suggestions.splice(s):f.length<=o&&u.Suggestions.splice(h):n.config.enableMRUDSBV2&&n.shouldShowDSBFullWidth()?u.Suggestions.splice(n.config.maxMruDSBV2):u.Suggestions.splice(c)}}if(n.config.enableMruProviderInQF&&((v=this._mruInMemoryCache)===null||v===void 0?void 0:v.getSize())>0&&!(t===null||t===void 0?void 0:t.isSearchHomeZI)&&(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())===3){u.Suggestions||(u.Suggestions=[]);let r=(y=u.Suggestions)===null||y===void 0?void 0:y.filter(n=>{var t;return((t=n===null||n===void 0?void 0:n.suggestionData)===null||t===void 0?void 0:t.handoffType)!=0});u.Suggestions=r;let i=(p=this._mruInMemoryCache)===null||p===void 0?void 0:p.search(t===null||t===void 0?void 0:t.queryToFetch,n.config.useLaunchCount,n.config.useLaunchTime,n.config.useRankerRankScore);i&&i.forEach(n=>u.Suggestions.push(n))}return u}fetch(t,i,r,u,f){if(n.isDataSourceEnabled(this.dataSource,t))return super.fetch(t,i,r,u,f)}static removeRankerSignals(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t}addToResponseIfNotPresent(n,t){let i=n.find(n=>n.suggestionData.suggestionKey==t.suggestionData.suggestionKey);if(i){let n=i.remove;i.remove=i=>n(()=>t.remove(i));i.rankingData.lastLaunchTime=Math.max(i.rankingData.lastLaunchTime,t.rankingData.lastLaunchTime);i.rankingData.prefixLaunchCount+=t.rankingData.prefixLaunchCount;t.rankingData.previewPaneLaunchCount&&(i.rankingData.previewPaneLaunchCount=(i.rankingData.previewPaneLaunchCount||0)+t.rankingData.previewPaneLaunchCount);t.rankingData.lastPreviewPaneLaunchTime&&(i.rankingData.lastPreviewPaneLaunchTime=i.rankingData.lastPreviewPaneLaunchTime?Math.max(i.rankingData.lastPreviewPaneLaunchTime,t.rankingData.lastPreviewPaneLaunchTime):t.rankingData.lastPreviewPaneLaunchTime)}else n.push(t)}addToDataIfNotPresent(t,i){if(n.config.enableMruProviderInQF){let n=t.find(n=>this.areEqual(n,i));n||t.push(i)}else{let n=JSON.stringify(i,r.removeRankerSignals),u=t.find(t=>JSON.stringify(t,r.removeRankerSignals)==n);u||t.push(i)}}areEqual(n,t){return n.handoffType==t.handoffType&&n.hc==t.hc&&n.suggestionKey==t.suggestionKey&&n.type==t.type&&(n===null||n===void 0?void 0:n.additionalInfoText)==(t===null||t===void 0?void 0:t.additionalInfoText)&&(n===null||n===void 0?void 0:n.isAnswer)==(t===null||t===void 0?void 0:t.isAnswer)&&(n===null||n===void 0?void 0:n.narratorText)==(t===null||t===void 0?void 0:t.narratorText)&&(n===null||n===void 0?void 0:n.query)==(t===null||t===void 0?void 0:t.query)&&(n===null||n===void 0?void 0:n.segments)==(t===null||t===void 0?void 0:t.segments)&&(n===null||n===void 0?void 0:n.primaryMetadata)==(t===null||t===void 0?void 0:t.primaryMetadata)}isSuggestionGroupTypeSupported(t){return this.dataSource==="MWS"?(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkMruEnabled())?n.isWorkScopeMruGroupType(t):!1:!n.isWorkScopeMruGroupType(t)}storeSuggestionToMRU(t,i,r){if(this.isSuggestionGroupTypeSupported(t)&&this.loggingEnabled()&&(!n.isZeroInputRecentsDisabledByRegionalPolicy()||!this.dmaWebRecentsType.includes(t.handoffType))){if(this._writing){this._pendingWrites.push(()=>this.storeSuggestionToMRU(t,i,r));return}this._writing=!0;let u=this.getKey(i,t===null||t===void 0?void 0:t.staticGroupType);this._lastKey==u?this.updateAndSaveLaunchData(u,this._valueForLastKey,t,r):this.queryStorage(u,n=>this.updateAndSaveLaunchData(u,n,t,r),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())}}remove(n,t,i){if(this._writing){this._pendingWrites.push(()=>this.remove(n,t,i));return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,r=>this.removeAndSaveLaunchData(n,r,t,i),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())}createOrUpdateDbEntry(i,r,f,e){r?(r.LastUpdated=t.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),r.SuggestionEngagementData=r.SuggestionEngagementData||{}):r={LastUpdated:t.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),SuggestionEngagementData:{}};let o=this.getSuggestionKey(f);if(r.SuggestionEngagementData[o]=this.updateMRUEntryClicksAndTime(r.SuggestionEngagementData[o],r.LastUpdated,e),this.getGroupType&&(r.SuggestionEngagementData[o].groupType=this.getGroupType(f)),n.LightweightStorage.getItem(u)=="1"&&this.isMRUHistoryGroupType&&this.isMRUHistoryGroupType(f)&&n.LightweightStorage.removeItem(u),this.candidatesEnabled()){let t=f.getMruData();if(t&&i&&(r.Suggestions||(r.Suggestions=[]),this.addToDataIfNotPresent(r.Suggestions,t),n.config.enableMruProviderInQF&&this._mruInMemoryCache)){let i=t;if(i&&(i===null||i===void 0?void 0:i.handoffType)==0){let u={suggestionData:t,rankingData:r.SuggestionEngagementData[o],remove:()=>{}};this._mruInMemoryCache.add(i.query,u,n.config.useLaunchCount,n.config.useLaunchTime)}}}return r}updateMRUEntryClicksAndTime(n,t,i){return n?(n.prefixLaunchCount+=1,n.lastLaunchTime=t):n={prefixLaunchCount:1,lastLaunchTime:t},i&&(n.previewPaneLaunchCount=(n.previewPaneLaunchCount||0)+1,n.lastPreviewPaneLaunchTime=t),n}getOldestDateToKeep(){let i=n.getCurrentDate();return i.setDate(i.getDate()-f),t.ClientSideStorage.StorageBasedDataProvider.getUnixTime(i)}updateAndSaveLaunchData(t,i,r,u){if(i=n.safeExecute(()=>this.createOrUpdateDbEntry(t,i,r,u),"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}n.safeExecute(()=>this.removeOldLaunches(i,this.getOldestDateToKeep()),"removeOldLaunches");this._lastKey=t;this._valueForLastKey=i;(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&n.PSCache&&n.PSCache.changeMRUDbEntries(t,i);this.withStorage(n=>n.put(t,i,()=>this.onAfterWrite(),n=>{this.onError(n,"updateAndSaveLaunchData");this.onAfterWrite()}))||this.onAfterWrite()}removeAndSaveLaunchData(t,i,r,u){if(!i){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}let f=-1;if(n.config.enableMruProviderInQF)f=(i.Suggestions||[]).findIndex(n=>this.areEqual(n,r));else{let n=JSON.stringify(r);f=(i.Suggestions||[]).findIndex(t=>JSON.stringify(t)==n)}if(f==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}i.Suggestions.splice(f,1);this._lastKey=t;this._valueForLastKey=i;(n.PSManager===null||n.PSManager===void 0?void 0:n.PSManager.isPSFeatureEnabled(this.dataSource))&&n.PSCache&&n.PSCache.changeMRUDbEntries(t,i);this.withStorage(f=>f.put(t,i,()=>{if(u&&u(),n.config.enableMruProviderInQF&&this._mruInMemoryCache){let t=r;t&&(t===null||t===void 0?void 0:t.handoffType)==0&&this._mruInMemoryCache.remove(t===null||t===void 0?void 0:t.query,n.config.useLaunchCount,n.config.useLaunchTime)}this.onAfterWrite()},n=>{this.onError(n,"removeAndSaveLaunchData");this.onAfterWrite()}))||this.onAfterWrite()}getRankingData(n,t){return n.SuggestionEngagementData?n.SuggestionEngagementData[t.suggestionKey]:undefined}removeOldLaunches(n,t){if(n.Suggestions)for(let i=n.Suggestions.length-1;i>=0;--i){let r=this.getRankingData(n,n.Suggestions[i]),u=r?r.lastLaunchTime:null;(!u||u<t)&&n.Suggestions.splice(i,1)}this.removeOldEngagementData(n.SuggestionEngagementData,t)}removeOldEngagementData(n,t){if(n)for(let i in n){let r=n[i];if(r){let u=r.lastLaunchTime;(!u||u<t)&&delete n[i]}}}prune(n){if(this._writing){this._pendingWrites.push(()=>this.prune(n));return}this._writing=!0;this.withStorage(t=>t.removeRangeOnSecondaryKey(0,this.getOldestDateToKeep(),()=>{n&&n(),this.onAfterWrite()},n=>{this.onError(n,"MRUDataProvider prune");this.onAfterWrite()}))||this.onAfterWrite()}instrumentMRUSize(t){let i=0;for(let{value:n}of t)n.Suggestions&&(i+=n.Suggestions.length);let r={totalnumberOfEntries:t.length.toString(),totalNumberOfSuggestions:i.toString()};n.InstrumentationHelper.logClientInstEvent("ClientInst","MRUSize",null,r)}}r._instrumentedStrings={};i.MRUDataProvider=r;n.MRU=n.Old.MRU})(i=t.MRU||(t.MRU={}))})(t=n.Old||(n.Old={}))}(WSB||(WSB={})),function(n){var t;(function(t){function d(t,i){if(!i)throw new Error("Undefined query IQuery for data source: "+t);u||ht();let r=u[t];if(!r)throw new Error("Unsupported data source: "+t);if(n.config.indexerQuerySimplified&&t=="IFF"&&(i===null||i===void 0?void 0:i.queryToFetch.length)<=8)return r[4];let f=r.filter(n=>!n.enabled||n.enabled(i));if(f.length==0)throw new Error("No enabled strategies for data source: "+t);else if(f.length>1)throw new Error("Multiple strategies for data source: "+t);else return f[0]}function tu(n){return u||ht(),!!u[n]}function iu(n,t,i){if(!u||!u[i]||t.taskFrame)return!1;let r=d(i,t);return r.sfgaoFilter?!r.sfgaoFilter(n.getProperty("System.SFGAOFlags")):!1}function i(n,t){return n=rr.concat(n),t&&(n=n.concat(ur)),n}function ht(){a=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getUserSID();let t=0,[f,e]=ki(t,a,!1),[o,s]=ki(t,a,!0);ft=f;ci=e;u={};n.config.win10FastFileProviderSqlOptimizations?uu(a,u):ru(f,o,e,s,u);let h='"System.Kind" != ANY ARRAY'+fr+" AND "+o;u.MFF=[{selectFields:i(c,!1),filterFieldsSets:[nu],mostRelevantProps:null,kindAndScopeClauses:null,sortClause:null,searchOptions:0,sfgaoFilter:null}];u[yt]=[{selectFields:i(c,!0),filterFieldsSets:[],mostRelevantProps:null,kindAndScopeClauses:h,sortClause:r,searchOptions:0,sfgaoFilter:s}];fu(a,u)}function ru(t,u,f,e,o){let v='"System.Kind" != ANY ARRAY['+ot.concat("link").map(n=>"'"+n+"'").join(", ")+"] AND "+t,tt="\"System.Kind\" = SOME ARRAY['program'] AND "+u,s='"System.Kind" != ANY ARRAY['+ai.map(n=>"'"+n+"'").join(", ")+"] AND "+u,a='"System.Kind" != ANY ARRAY['+li.concat(ot).concat("folder").map(n=>"'"+n+"'").join(", ")+"] AND "+u,ft="\"System.Kind\" = SOME ARRAY['folder'] AND "+u,p="\"System.Kind\" = SOME ARRAY['Music'] AND "+u,w="\"System.Kind\" = SOME ARRAY['Picture'] AND "+u,d='"System.Kind" = SOME ARRAY['+et.map(n=>"'"+n+"'").join(", ")+"] AND "+u,st="\"System.Kind\" != ANY ARRAY['game', 'calendar', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage'] AND "+u;o.IFF=[{selectFields:i(c,!1),filterFieldsSets:[ri],mostRelevantProps:b,kindAndScopeClauses:v,sortClause:n.config.enableIndexerQueryExtensionSort?g(y):r,searchOptions:3,sfgaoFilter:f,enabled:t=>!!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)},{selectFields:i(c,!1),filterFieldsSets:[],mostRelevantProps:b,kindAndScopeClauses:v,sortClause:n.config.enableIndexerQueryExtensionSort?g(y):r,searchOptions:0,sfgaoFilter:f,enabled:t=>!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)},{selectFields:i(it,!0),filterFieldsSets:[lr],mostRelevantProps:b,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?g(y):r,searchOptions:3,sfgaoFilter:e,enabled:t=>!!(t===null||t===void 0?void 0:t.queryToFetch)&&n.supportsShortcuts("IFF",t)},{selectFields:i(it,!0),filterFieldsSets:[],mostRelevantProps:b,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?g(y):r,searchOptions:0,sfgaoFilter:e,enabled:t=>t&&!t.queryToFetch&&n.supportsShortcuts("IFF",t)},{selectFields:i(c,!0),filterFieldsSets:[ar],mostRelevantProps:b.concat(["System.Title"]),kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?g(y):r,searchOptions:0,sfgaoFilter:e,enabled:t=>n.config.indexerQuerySimplified&&(t===null||t===void 0?void 0:t.queryToFetch.length)<=8&&!!(t===null||t===void 0?void 0:t.queryToFetch)}];o.MDOC=[{selectFields:i(h,!0),filterFieldsSets:[fi.concat(pr)],mostRelevantProps:nt,kindAndScopeClauses:a,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:t=>(t===null||t===void 0?void 0:t.queryToFetch)&&n.config.minLengthForContentMatch&&(t===null||t===void 0?void 0:t.queryToFetch.length)>=n.config.minLengthForContentMatch},{selectFields:i(h,!0),filterFieldsSets:[fi],mostRelevantProps:nt,kindAndScopeClauses:a,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:t=>(t===null||t===void 0?void 0:t.queryToFetch)&&(!n.config.minLengthForContentMatch||(t===null||t===void 0?void 0:t.queryToFetch.length)<n.config.minLengthForContentMatch)},{selectFields:i(h,!0),filterFieldsSets:[],mostRelevantProps:nt,kindAndScopeClauses:a,sortClause:r,searchOptions:0,sfgaoFilter:e,enabled:n=>n&&!n.queryToFetch},];o.MPVD=[{selectFields:i(h.concat(l).concat(n.config.myStuffPhotoVideoStrategyFix?k:l),!0),filterFieldsSets:[rt],mostRelevantProps:nt,kindAndScopeClauses:st,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)}];o.MFOL=[{selectFields:i(ei,!0),filterFieldsSets:[br],mostRelevantProps:wr,kindAndScopeClauses:ft,sortClause:r,searchOptions:3,sfgaoFilter:e}];o.MPHO=[{selectFields:i(k,!0),filterFieldsSets:[kr],mostRelevantProps:oi,kindAndScopeClauses:w,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(k,!0),filterFieldsSets:[],mostRelevantProps:oi,kindAndScopeClauses:w,sortClause:r,searchOptions:0,sfgaoFilter:e,enabled:n=>n&&!n.queryToFetch},];o.MVID=[{selectFields:i(l,!0),filterFieldsSets:[dr],mostRelevantProps:si,kindAndScopeClauses:d,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(l,!0),filterFieldsSets:[],mostRelevantProps:si,kindAndScopeClauses:d,sortClause:r,searchOptions:0,sfgaoFilter:e,enabled:n=>n&&!n.queryToFetch},];o.MMUS=[{selectFields:i(ut,!0),filterFieldsSets:[gr],mostRelevantProps:hi,kindAndScopeClauses:p,sortClause:r,searchOptions:3,sfgaoFilter:e,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(ut,!0),filterFieldsSets:[],mostRelevantProps:hi,kindAndScopeClauses:p,sortClause:r,searchOptions:0,sfgaoFilter:e,enabled:n=>n&&!n.queryToFetch},];o.IBA=[{selectFields:i(ui,!0),filterFieldsSets:[yr],mostRelevantProps:vr,kindAndScopeClauses:tt,sortClause:r,searchOptions:3,sfgaoFilter:e}]}function uu(n,t){let r=ef(n);t.IFF=[{selectFields:i(it,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MDOC=[{selectFields:i(h,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:ii+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MPVD=[{selectFields:i(h,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:ii+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MFOL=[{selectFields:i(ei,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:er+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MPHO=[{selectFields:i(k,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:sr+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MVID=[{selectFields:i(l,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:hr+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.MMUS=[{selectFields:i(ut,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:or+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}];t.IBA=[{selectFields:i(ui,!0),filterFieldsSets:[o],mostRelevantProps:e,kindAndScopeClauses:cr+" AND "+r,sortClause:s,searchOptions:3,sfgaoFilter:null}]}function fu(t,r){let u=cu(t);r.ANA=[{selectFields:i(w,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:u,sortClause:p,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&!n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==0},{selectFields:i(w,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:p,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==1},{selectFields:i(w,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:p,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==2},{selectFields:i(w,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:p,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==3},{selectFields:i(w,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:p,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==4},]}function eu(n,t,i,r,u){var f;return bu((f=n===null||n===void 0?void 0:n.queryToFetch)!==null&&f!==void 0?f:"").then(f=>yi(n,f,t,i,r,u))}function ou(n,t,i,r){let u=d(t,n),f="SELECT TOP "+i.length+" "+lt(u.selectFields)+" FROM SystemIndex WHERE "+yu(u,i,r),e=pi(r);return e!=""&&(f+=" AND "+e),f}function su(){let n=d(yt,null),t="WorkId, "+lt(n.selectFields),i=n.kindAndScopeClauses;return"SELECT "+t+" FROM SystemIndex WHERE "+i+" ORDER BY "+n.sortClause}function hu(n,t){u&&u[n]&&u[n][t]&&(u[n][t].kindAndScopeClauses=lu(a,t))}function cu(t){let i=(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())?n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold():14,r='"System.DateCreated" > DATEADD(day, -'+i+", GETGMTDATE())",u="(SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Canary/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Dev/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Beta/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Stable/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/undefined/Profiles/')";return r+" AND "+u}function vi(t,i,r,u){let f="";return f+='"System.Link.TargetUrl" IS NOT NULL AND "System.Title" IS NOT NULL AND ',f+='"System.DateCreated" > DATEADD(day, -'+(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())+", GETGMTDATE()) AND (",f+=ct(t,i,r,u),f+")"}function ct(n,t,i,r){let u="";for(let f=0;f<i.length;f++){if(u+="SCOPE = 'winrt://{"+n+"}/LS/Desktop/Microsoft Edge/"+i[f].displayName+"/"+r.displayName+"/"+t+"/'",f==i.length-1)break;u+=" OR "}return u}function lu(t,i){let r=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getAvailableChannels(),u=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getSelectedProfile();if(r&&u)switch(i){case 1:return vi(t,"History",r,u);case 2:return ct(t,"QuickLinks",r,u);case 3:return vi(t,"RecentlyClosed",r,u);case 4:return ct(t,"Favorites",r,u)}return""}function yi(n,t,i,r,u,f){var s,h;let c=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getLCIDStringForText((s=n===null||n===void 0?void 0:n.queryToFetch)!==null&&s!==void 0?s:""),e=n.taskFrame?uf(u,n.taskFrame.parsed,c):d(u,n),o="SELECT TOP "+r+" "+lt(e.selectFields)+" FROM SystemIndex",l=pu(e,(h=n===null||n===void 0?void 0:n.queryToFetch)!==null&&h!==void 0?h:"",t,i,e.searchOptions,c,f);if(l!=""){o=o+" WHERE "+l;let n=pi(f);n!=""&&(o+=" AND "+n)}return o+=" ORDER BY "+e.sortClause}function au(n){if(n.kind=="link"||n.kind=="program"){let i=n.getProperty("System.Kind");for(var t=0;t<i.length;t++){let r=i[t];if(r=="program")return vu(n,r);if(r!="link"){let t={displayName:n.displayName,id:n.id,kind:r,getProperty:t=>n.getProperty(t),propertyHits:n.propertyHits,rankScore:n.rankScore,getImageAsync:t=>n.getImageAsync(t),imageType:n.imageType,canHaveContextMenu:n.canHaveContextMenu,getVerbsAsync:()=>n.getVerbsAsync(),extension:n.extension,itemTypeDisplayName:n.itemTypeDisplayName,createdDate:n.createdDate,lastModifiedDate:n.lastModifiedDate};return t.originalDeviceItem=n,t}}}return n}function vu(t,i){let r=t.displayName;r.toLocaleLowerCase().endsWith(".lnk")&&(r=r.substr(0,r.length-4));let u=n.indexerFilePathToRegularPath(t.id),f={displayName:r,id:u,kind:i,getProperty:n=>t.getProperty(n),propertyHits:t.propertyHits,rankScore:t.rankScore,getImageAsync:n=>t.getImageAsync(n),imageType:t.imageType,canHaveContextMenu:t.canHaveContextMenu,getVerbsAsync:()=>t.getVerbsAsync(),extension:t.extension,itemTypeDisplayName:t.itemTypeDisplayName,createdDate:t.createdDate,lastModifiedDate:t.lastModifiedDate,filePath:u,lastAccessed:t.getProperty("System.DateAccessed"),version:null,isImmersive:!1,logoBackgroundColor:null,launchArguments:null,totalLaunches:null,isTrustedApp:!1,packageFamilyName:null,jumpList:null,getJumpListAsync:null,voiceCommandExamples:null,rawIndexResponse:null};return f.originalDeviceItem=t,f}function lt(n){return n.map(n=>n=="System.ParsingPath"?"path":`"${n}"`).join(",")}function pi(t){return n.config.useWhereId&&t?"ReuseWhere("+t+") ":""}function yu(n,t){return"("+ku(n,t)+")"}function pu(n,t,i,r,u,e){let o="";n.mostRelevantProps.length>0&&(o+="WITH ("+n.mostRelevantProps.join(", ")+") AS #MRProps ");let s=du(n,t,i,u,e);s&&(o+="("+s+") AND ");let h=r?f(r):r;return h&&(o+="(Scope = '"+h+"') AND "),o+n.kindAndScopeClauses}function wu(n,t){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.tokenize(n,t)}function bu(n){return SearchAppWrapper.CortanaApp.queryFormulationView.getLinguisticDataAsync(n)}function at(t,i,r){let u="",f=t.filterFieldsSets.length>1;return t.filterFieldsSets.forEach(t=>{f&&(u?u+=") AND (":u="(");let e=!0;for(let f of t){let t=!1;for(let o of i)e?(u+="(",e=!1):u+=t?" OR ":" OR (",u+=n.config.win10FastFileProviderSqlOptimizations?n.formatString(f,[o,r]):n.formatString(f,[o]),t=!0;t&&(u+=")")}}),f&&(u+=")"),u}function ku(t,i){let r=[];return r=n.config.disableMRUFilesAndFoldersWildCards?i.map(n=>f(n)):i.map(n=>vt(n)),at(t,r)}function du(t,i,r,u,f){let s=[i];(r===null||r===void 0?void 0:r.alternatives)&&r.alternatives.forEach(n=>s.push(n));let e=s.map(n=>vt(n)),o=n.config.win10FastFileProviderSqlOptimizations?at(t,e,f):at(t,e);return(u&2)==2&&(o=gu(u,r,e,o,f)),o}function gu(t,i,r,u,f){let o=nf(t),e=!1;for(let s of o){let o=!1;for(let h of r){let c=[],r=wu(h,i.language);if(e&&n.config.indexerQueryMWLimit){if((t&4)==0||r.length<=n.config.indexerQueryMWLimit)for(let t=0;t<Math.min(r.length,n.config.indexerQueryMWLimit);++t)c.push(r[t])}else if((t&4)==0||r.length<=ti)for(let n=0;n<Math.min(r.length,ti);++n)c.push(r[n]);if(c.length>1){let t="";for(let n of c)t&&(t+=" AND "),t+='"'+n+(e?'*"':'"');u?u+=o?" OR ":" OR (":u="(";u+=n.formatString(s,[t,f]);o=!0}}o&&(u+=")");e=!e}return u}function nf(n){let t=[];return t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 600)"),(n&1)==1&&t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 550)"),t}function wi(t,i){return t.length>0&&(t=t.replace(/'/g,"''"),t=t.replace(/"/g," "),i>=2&&(n.config.sqlEscFix&&(t=t.replace(/\[/g,"[[]")),t=t.replace(/%/g,"[%]"),t=t.replace(/_/g,"[_]"),n.config.sqlEscFix||(t=t.replace(/\[/g,"[[]")),i==3?(t=t.replace(/\*/g,"%"),t=t.replace(/\?/g,"_")):(t=t.replace(/\*/g," "),t=t.replace(/\?/g," ")))),t}function f(n){return wi(n,1)}function vt(n){return wi(n,2)}function tf(n){let t=tt[n];if(t)return t;throw new Error("select fields for NL Data source was not found: "+n);}function v(n,t,i,...r){typeof i=="string"?(i=vt(i),t.push(r.map(t=>`CONTAINS(${t},'"${i}*"',${n}) RANK BY COERCION(ABSOLUTE, 1000)`))):i&&i.Value&&v(n,t,i.Value,...r)}function uf(n,t,i){let f=[],e='"System.Kind" != ANY ARRAY['+st+"]";if(t.FileType&&t.FileType.Value){let n=t.FileType.Value;switch(n){case"Document":break;case"Picture":e="\"System.Kind\" = SOME ARRAY['Picture']";break;case"Video":e='"System.Kind" = SOME ARRAY['+et.map(n=>"'"+n+"'").join(", ")+"]";break;case"Powerpoint":case"Word":case"Excel":e="CONTAINS(System.ItemType,'\""+rf[n]+"*\"',"+i+') RANK BY COERCION(ABSOLUTE, 1000) AND "System.Kind" != ANY ARRAY['+st+"]";break;default:e='"System.Kind" != ANY ARRAY['+st+"]";v(i,f,n,"System.ItemType","System.ItemTypeText")}}v(i,f,t.Title,"System.ItemNameDisplay","System.Title");v(i,f,t.Body,"System.ItemNameDisplay","System.Title","System.FileDescription","System.Keywords","System.Search.Contents");t.People&&t.People.forEach(n=>{let t=n.Value;t&&v(i,f,t=="me"?SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.userName:t,"System.Author","System.FileOwner","System.Document.LastAuthor","System.Photo.TagViewAggregate")});v(i,f,t.Place,"System.Photo.TagViewAggregate");let u=ff(t.Time);u&&f.push(["System.DateCreated>='"+u[0]+"' AND System.DateCreated<'"+u[1]+"'","System.DateModified>='"+u[0]+"' AND System.DateModified<'"+u[1]+"'","System.DateAccessed>='"+u[0]+"' AND System.DateAccessed<'"+u[1]+"'","System.DateArchived>='"+u[0]+"' AND System.DateArchived<'"+u[1]+"'","System.DateAcquired>='"+u[0]+"' AND System.DateAcquired<'"+u[1]+"'",]);return{selectFields:tf(n),filterFieldsSets:f,kindAndScopeClauses:e?e+" AND "+ft:ft,mostRelevantProps:[],searchOptions:0,sortClause:r,sfgaoFilter:ci}}function ff(t){if(!t)return null;let i=t.value;if(!i)return null;let f=i.indexOf("T");f!=-1&&(i=i.substr(0,f));let u=i.split("-");if(u.length<2||u.length>3)return null;let e=new Date(i);if(!n.isValidDate(e))return null;let r=new Date(i);return u.length==3?r.setUTCDate(r.getUTCDate()+1):r.setUTCMonth(r.getUTCMonth()+1),[bi(e),bi(r)]}function bi(n){let t=n.toISOString();return t.substr(0,t.indexOf("T"))}function ki(t,i,r){let u,e;r||(u="NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['hidden'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['system'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['link']");r?e=n=>!(n&gi)&&!(n&di)&&(!!(n&&nr)||n&&ir&&!!(n&&ni)||n&&tr&&!!(n&&ni)):(u+=" AND (System.Shell.SFGAOFlagsStrings = SOME ARRAY['stream']",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['fileanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['storageanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=")");r?u="System.Shell.OmitFromView != 'true'":u+=" AND System.Shell.OmitFromView != 'true'";let o=f(n.getKnownFolderPathLC(n.FOLDERID_Profile));switch(t){case 0:let e=f(n.getKnownFolderPathLC(bt));u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}') AND (Scope <> 'file:"+o+"\\AppData') AND (Scope <> 'file:"+e+"\\Default\\AppData') AND (Scope <> 'file:"+e+"\\Administrator\\AppData')";let s=f(n.getKnownFolderPathLC(pt)),h=f(n.getKnownFolderPathLC(wt));u+=" AND (Scope <> 'file:"+s+"')";h!=s&&(u+=" AND (Scope <> 'file:"+h+"')");let c=f(n.getKnownFolderPathLC(kt));u+=" AND (Scope <> 'file:"+c+"')";let l=f(n.getKnownFolderPathLC(dt));if(u+=" AND (Scope <> 'file:"+l+"')",r){let t=f(n.getKnownFolderPathLC(gt));u+=" AND (Scope <> 'file:"+t+"')"}break;case 1:u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}')";break;default:throw new Error("Unknown SearchScope: "+t);}return[u,e]}function ef(t){let i="",o=f(n.getKnownFolderPathLC(n.FOLDERID_Profile)),r=f(n.getKnownFolderPathLC(bt));i+="(Scope = 'file://' OR Scope = 'csc://{"+t+"}') AND (Scope <> 'file:"+o+"\\AppData') AND (Scope <> 'file:"+r+"\\Default\\AppData') AND (Scope <> 'file:"+r+"\\Administrator\\AppData')";let u=f(n.getKnownFolderPathLC(pt)),e=f(n.getKnownFolderPathLC(wt));i+=" AND (Scope <> 'file:"+u+"')";e!=u&&(i+=" AND (Scope <> 'file:"+e+"')");let s=f(n.getKnownFolderPathLC(kt));i+=" AND (Scope <> 'file:"+s+"')";let h=f(n.getKnownFolderPathLC(dt));i+=" AND (Scope <> 'file:"+h+"')";let c=f(n.getKnownFolderPathLC(gt));return i+(" AND (Scope <> 'file:"+c+"')")}function g(n){let t="CASE ",i=1;for(let r of n)t+="WHEN 'System.FileExtension' = "+r+" THEN "+i.toString()+" ",i+=1;return t+="ELSE 999 END ASC, "+r}const yt="PRIME",pt="{905e63b6-c1bf-494e-b29c-65b732d3d21a}",wt="{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}",bt="{0762D272-C50A-4BB0-A382-697DCD729B80}",kt="{A4115719-D62E-491D-AA7C-E74B8BE3B067}",dt="{0482af6c-08f1-4c34-8c90-e17ec98b1e17}",gt="{bfb9d5e0-c6a9-404c-b2b2-ae6db6af4968}",di=4096,gi=524288,nr=4194304,ni=536870912,tr=8388608,ir=268435456,ti=3,r='"System.Search.Rank" DESC, "System.DateModified" DESC, "System.ItemNameDisplay" ASC',y=['".exe"','".xlsx"','".lnk"','".docx"','".xls"','".doc"','".bat"','".pptx"','".pdf"','".txt"',],rr=["System.Kind","System.Search.Rank","System.ParsingPath","System.DateCreated","System.DateModified","System.Search.QueryPropertyHits","System.ItemNameDisplay","System.FileExtension","System.ItemType",],ur=["System.Link.TargetParsingPath","System.SFGAOFlags",],e=["System.ItemNameDisplay",],o=["(CONTAINS(#MRProps, '\"{0}\"', {1}) RANK BY COERCION(ABSOLUTE, 990))","(CONTAINS(#MRProps, '\"{0}*\"', {1}) RANK BY COERCION(ABSOLUTE, 980))",],s='"System.Search.Rank" DESC, "System.DateModified" DESC',fr="['calendar', 'game', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage']",er="\"System.Kind\" = 'folder'",or="\"System.Kind\" = 'music'",sr="\"System.Kind\" = 'picture'",hr="\"System.Kind\" = SOME ARRAY['Movie', 'RecordedTV', 'Video']",ii='("System.Kind" = \'document\' or "System.Kind" IS NULL)',cr="\"System.Kind\" = SOME ARRAY['program', 'link']",p='"System.DateCreated" DESC, "System.Link.DateVisited" DESC, "System.History.VisitCount" DESC, "System.History.SelectionCount" DESC',w=["System.ApplicationName","System.Document.Version","System.Identity","System.Status","System.ContentType","System.ProviderItemID","System.Link.TargetUrl","System.Title","System.Link.DateVisited","System.History.VisitCount","System.History.SelectionCount",],c=["System.Title","System.Music.AlbumTitle","System.Music.DisplayArtist"],b=["System.ItemNameDisplay","System.Music.DisplayArtist","System.Music.AlbumTitle",];let ri=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 760)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 660)",];const it=c.concat("System.DateAccessed"),lr=ri.concat(["CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)"]);let ar=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)",];const ui=["System.DateAccessed",],vr=["System.ItemNameDisplay",];let yr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 795)",];const h=["System.Search.AutoSummary","System.Keywords","System.Title","System.Author","System.Document.LastAuthor",],nt=["System.ItemNameDisplay","System.Keywords","System.Title",];let rt=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",];n.config.onlyWhereContains||(rt=rt.concat(["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Photo.TagViewAggregate = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Music.DisplayArtist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.Genre = '{0}' RANK BY COERCION(ABSOLUTE, 950)",]));let fi=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)",];const pr="CONTAINS(System.Search.Contents, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 545)",ei=[],wr=["System.ItemNameDisplay",];let br=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)",];const k=["System.Photo.TagViewAggregate","System.Title",],oi=["System.ItemNameDisplay","System.Photo.TagViewAggregate",];let kr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",];const l=["System.Title","System.Keywords","System.Music.DisplayArtist","System.Music.Genre",],si=["System.ItemNameDisplay","System.Title","System.Keywords",];let dr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],ut=["System.Title","System.Music.DisplayArtist","System.Music.AlbumTitle","System.Music.Genre",];const hi=["System.ItemNameDisplay","System.Title","System.Music.AlbumTitle",];let gr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 865)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",];const nu=["path = '{0}'"];let u;t.getStrategy=d;t.dataSourceSupported=tu;t.suppress=iu;let a,ft,ci;const et=["Movie","RecordedTV","Video"],li=et.concat(["Picture","Music"]),ai=["calendar","game","web history","feed","contact","task","journal","note","instantmessage"],ot=ai.concat("program"),st=li.concat(ot).concat(["folder","link"]).map(n=>"'"+n+"'").join(",");t.initStrategies=ht;t.generateIndexerQueryAsync=eu;t.generateIndexerQueryForMRUFilesAndFolders=ou;t.generateIndexerPrimerQuery=su;t.updateAnaheimStrategy=hu;t.generateIndexerQuery=yi;t.fixKind=au;let tt={};tt.MPHO=i(k,!1);tt.MVID=i(l,!1);tt.MDOC=i(h,!1);const rf=(()=>{let n={};return n.Powerpoint="ppt",n.Word="doc",n.Excel="xls",n})()})(t=n.IndexerQueryGenerator||(n.IndexerQueryGenerator={}))}(WSB||(WSB={})),function(n){function a(t,i,r,u,f,e,o,s){let h=u?r+" "+i:r;return n.Async.safeChainWithGlobalCaching("getIcon",i=>t.getImageAsync(n.getImageSizeValue(i)),n=>n+"_"+i,i=>n.toIcon(i,"getIcon.toIcon",e,o,h,n.config.newFilesPreviewPane?t===null||t===void 0?void 0:t.imageType:null),e,f?()=>(t===null||t===void 0?void 0:t.imageType)===0:null,h,null,s)}function i(t,i,r,u,f,e){return{deviceItem:t,getIcon:a(t,t.id,r,r&&!n.localDataSourceMayContainPII(r),n.displayedInGridLayout(i),u,f,0),icon:e?u:null,suggestionType:i}}function v(n,t,i){return{deviceItem:n,icon:i,suggestionType:t}}function vt(n){return n.map(n=>({isSimulated:!0,displayName:n,id:null,kind:null,getProperty:null,propertyHits:null,rankScore:null}))}function y(){if(n.config.wsbWebView2&&SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.fetchForTopLocalAppsAsync)return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.fetchForTopLocalAppsAsync(f,l,6);else{let t=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getAllAppsAsync();return t.then(t=>{let i=[];for(let r in t){let u=t[r];u&&(n.config.allowZeroLaunchTopApps||u.totalLaunches>0)&&!n.contains(l,u.id)&&i.push(u)}return n.config.minTopApps&&i.length<n.config.minTopApps?[]:i}).then(n=>n).then(n=>n).then(n=>{return yt(n),[].concat(n)})}}function yt(t){return t.sort((t,i)=>{let u=t.totalLaunches,e=i.totalLaunches;if(u!==0||e!==0)return e-u;let o=t.id,r=i.id;return n.contains(f,o)?n.contains(f,r)?f.indexOf(o)-f.indexOf(r):-1:n.contains(f,r)?1:0}),t}function r(t,i,r){switch(t){case"program":return"IBA";case"picture":return i&&n.contains(p,i.toLowerCase())?"FL":"LI";case"video":return i&&n.contains(w,i.toLowerCase())?"FL":"LV";case"movie":case"recordedtv":return"LV";case"music":return"MU";case"folder":return"FD";default:return r}}function pt(t,i){switch(t){case"picture":return i&&n.contains(p,i.toLowerCase())?!0:!1;case"video":return i&&n.contains(w,i.toLowerCase())?!0:!1;case"calendar":case"contact":case"email":case"feed":case"folder":case"game":case"instantmessage":case"journal":case"movie":case"music":case"note":case"playlist":case"recordedtv":case"searchfolder":case"task":case"web history":return!1;case"document":case"program":case"link":default:return!0}}function b(n,t){let i=t.filter(n=>pt(n.kind,n.extension));return i.slice(0,n)}function rt(t,i,r,u,f,o,s,h,c){let a=s&&c?t.filter(t=>n.contains(Object.keys(e),t)):[];a.length>0&&(t=t.filter(t=>!n.contains(a,t)));let l=t=>{for(let i of a){let r=e[i];t[i]={deviceItem:{id:i,displayName:n.Host.getLocString(r.locStringKey),kind:null,getProperty:()=>null,propertyHits:[],rankScore:1e3},icon:r.icon}}i(t)};n.safeExecute(()=>{if(t.length==0)l({});else{let e={},i=t.slice(0);if(h)for(let n=t.length-1;n>=0;--n){let r=t[n];h.hasOwnProperty(r)&&(e[r]=h[r],i.splice(n,1))}if(i.length==0)l(e);else{let c=!s||n.localDataSourceMayContainPII(s)?s:s+" "+i;n.Async.safeChain(r,()=>u(i),r=>{let u=n.Map.map(i,r,n=>f(n));if(h&&i.forEach(n=>h[n]=u[n]),i.length!=t.length)for(let n in e)e.hasOwnProperty(n)&&(u[n]=e[n]);l(u)},()=>l({}),o,c)}}},"resolveIdsWithCache",null,s,()=>l({}))}function wt(t,i,r,u,f,e,o,s){n.safeExecute(()=>{if(t.length==0)i({});else{let c={},h=t.slice(0);if(s)for(let n=t.length-1;n>=0;--n){let i=t[n].toLowerCase();s.hasOwnProperty(i)&&(c[i]=s[i],h.splice(n,1))}if(h.length==0)i(c);else{let l=!o||n.localDataSourceMayContainPII(o)?o:o+" "+h;n.Async.safeChain(r,()=>u(h),r=>{let u=n.Map.map(h,r,n=>{let t=[];return n.forEach(n=>t.push(f(n))),t});if(s&&h.forEach(n=>s[n]=u[n]),h.length!=t.length)for(let n in c)c.hasOwnProperty(n)&&(u[n]=c[n]);i(u)},()=>i({}),e,l)}}},"resolveDisplayNames",null,o,()=>i({}))}function bt(t,i,r,u,f,o,s,h,c){let v=s&&c?t.filter(t=>n.contains(Object.keys(e),t)):[];v.length>0&&(t=t.filter(t=>!n.contains(v,t)));let l=t=>{for(let i of v){let r=e[i];t[i]={deviceItem:{id:i,displayName:n.Host.getLocString(r.locStringKey),kind:null,getProperty:()=>null,propertyHits:[],rankScore:1e3},icon:r.icon}}i(t)},a=(t=new window.Map)=>{for(let i of v){let r=e[i];t.set(i,{deviceItem:{id:i,displayName:n.Host.getLocString(r.locStringKey),kind:null,getProperty:()=>null,propertyHits:[],rankScore:1e3},icon:r.icon})}i(t)};n.safeExecute(()=>{if(t.length==0)n.config.mapWrapperToJsMap?a():l({});else{let e={},c=new window.Map,i=t.slice(0);if(h)for(let r=t.length-1;r>=0;--r){let u=t[r];h.hasOwnProperty(u)&&(n.config.mapWrapperToJsMap?c.set(u,h[u]):e[u]=h[u],i.splice(r,1))}if(i.length==0)n.config.mapWrapperToJsMap?a(c):l(e);else{let v=!s||n.localDataSourceMayContainPII(s)?s:s+" "+i;n.Async.safeChain(r,()=>u(i),r=>{if(n.config.mapWrapperToJsMap){let n=new window.Map;if(i.forEach(t=>{let i=r[t];i&&n.set(t,f(i))}),h&&i.forEach(t=>h[t]=n.get(t)),i.length!=t.length)for(let[i,t]of c)t&&n.set(i,t);a(n)}else{let u=n.Map.map(i,r,n=>f(n));if(h&&i.forEach(n=>h[n]=u[n]),i.length!=t.length)for(let n in e)e.hasOwnProperty(n)&&(u[n]=e[n]);l(u)}},()=>n.config.mapWrapperToJsMap?a():l({}),o,v)}}},"resolveIdsWithCache",null,s,()=>n.config.mapWrapperToJsMap?a():l({}))}function ni(n,t){if(!t.launchArguments||gt.test(n.query))return!0;let i=t.id.toLowerCase();return ut.some(n=>i.includes(n))?!0:!1}function ft(t,i,r,u,f){if(!f)return!1;let o=t.displayName.toLocaleLowerCase(),e=i.queryToFetch.toLocaleLowerCase(),s=null;if(f.Parses&&f.Parses.length>0&&f.Parses[0].SubParses&&f.Parses[0].SubParses.length>1&&f.Parses[0].SubParses[0].Interpretation&&f.Parses[0].SubParses[0].Interpretation==="regex"&&e.length>=f.Parses[0].SubParses[0].QueryEnd&&f.Query!=null){if(e.length===f.Parses[0].SubParses[0].QueryEnd)return!0;e=e.substr(f.Parses[0].SubParses[0].QueryEnd+1);f.Query=f.Query.substr(f.Parses[0].SubParses[0].QueryEnd+1)}return e.length<n.config.filterCICandidatesPrefixLength&&!et(e,o)&&(s=n.matchesOnPropertyHH(o,e),!s)?!0:ui(o,e,t,r,u,f)?!0:!1}function ui(t,i,r,u,f,e){if(!i||!e||!e.MatchScore||!e.Parses||e.Parses.length==0||!e.Parses[0].Entities||e.Parses[0].Entities.length==0||!e.Query||t.startsWith(i)&&i.length>=n.config.filterCICandidatesPrefixLength)return!1;let o=e.Query;if(o.startsWith(i)||n.config.bypassCIFilterOnSubstringMatch&&t.split(" ").some(n=>n.startsWith(i)))return!1;let s=t.startsWith(o);if(!s)return!0;return f.Counter>=1?!0:(f.Counter++,!1)}function et(n,t){if(!!t&&t.length==0)return!1;let i=t.split(" ");if(n.length!=i.length)return!1;for(let t=0;t<i.length;t++)if(i[t].length==0||i[t][0]!=n[t])return!1;return!0}function ot(n){let i=n.id.toLowerCase();if(i.startsWith("http:")||i.startsWith("https:")||n.kind=="link"&&i.endsWith(".url"))return 1;if(i.startsWith("file:")||n.kind=="document")return 0;let t=n.filePath;if(t&&(t=t.toLowerCase(),t!=i)){if(t.startsWith("http:")||t.startsWith("https:")||n.kind=="link"&&t.endsWith(".url"))return 1;if(t.startsWith("file:"))return 0}return 2}function st(n,t){if(t.dataSource=="PP"){let t=ot(n);if(t==1)return"LURL";if(t==0)return"LDOC"}return t.getSuggestionType(n)}function ht(t){return t&&t.rawIndexResponse?n.safeExecute(()=>JSON.parse(t.rawIndexResponse),"parseConstraintIndexMetaData"):undefined}function ct(t,i,r,u,f,e){if(n.IndexerQueryGenerator&&n.IndexerQueryGenerator.suppress(i,t,u))return!0;if(r=="PP"){let h=i.id;if(n.contains(ti,h))return!0;let o=i;if(ft(o,t,!0,f,e))return!0;let r=i.kind;if(r&&(r=r.toLocaleLowerCase(),r!="program"&&r!="unknown")||u=="LRA"&&ot(o)!=2)return!0;let s=o.extension;return s&&s.toLowerCase()==".chm"?!0:!1}if(r!="LURL"&&i.kind=="link"&&n.RuntimeConfig.QfMode!=5)return!0;if(n.isSetting(r))return ft(i,t,!1,f,e)?!0:!1;let o=i;if(!n.IndexerQueryGenerator&&u=="MDOC"&&((o===null||o===void 0?void 0:o.propertyHitsString)=="System.Search.Contents"||o.propertyHits.length==1&&o.propertyHits[0]=="System.Search.Contents")&&(!n.config.minLengthForContentMatch||t.queryToFetch.length<n.config.minLengthForContentMatch))return!0;let s=o.id;if(s&&(n.RuntimeConfig.QfMode!=5&&(s.includes("\\.")||s.includes("/."))||(s=s.toLowerCase(),t.queryToFetch.toLocaleLowerCase()!=i.displayName.toLocaleLowerCase()&&ri.some(n=>s.includes("\\"+n+"\\")||s.includes("/"+n+"/")))))return!0;let h=o.extension;if(h&&n.RuntimeConfig.QfMode!=5&&!t.queryToFetch.toLowerCase().includes(h.toLowerCase())&&n.contains(ii,h.toLowerCase()))return!0;if(r=="CG"){let r=i,t=r.displayName.split(" ")[0].toLowerCase();if(t.includes("\\")||t.indexOf(":")==1)return!1;let u=r.id.toLowerCase(),f=u.lastIndexOf("."),e=u.lastIndexOf("\\"),o=r.kind=="folder"||f<0||f<e;if(o&&!t.includes("%")||![".exe",".com"].some(n=>t.includes(n))&&(kt.some(n=>u.includes(n))||!r.launchArguments&&ut.some(n=>u.includes(n))||n.contains(dt,t)))return!0}return!1}const c=":wux:",s="Classic_{87d66a43-7b11-4a28-9811-c86ee395acf7}",l=["Microsoft.XboxGamingOverlay_8wekyb3d8bbwe!App"],f=["Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge","windows.immersivecontrolpanel_cw5n1h2txyewy!microsoft.windows.immersivecontrolpanel","Microsoft.WindowsCalculator_8wekyb3d8bbwe!App","Microsoft.ScreenSketch_8wekyb3d8bbwe!App","{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}\\mspaint.exe","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\mspaint.exe"],lt=new Set(["!","@","#","$","^","%","&","*","(",")","<",">","[","]","{","}","~","`","?","/",",",".","+","-","_","=",":",";","|"]),at=1;n.getIcon=a;n.createLocalResponseSuggestionWithDeviceItemImage=i;n.fetchForTopLocalApps=y;const p=[".dwg",".ai",".psd"],w=[".ts"];n.getSuggestionTypeFromKindAndExtension=r;const h={getResultsContainer:n=>n.apps,dataSource:"PP",getSuggestionType:()=>"PP",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0};n.filterIFFResultsToHighPriFiles=b;const k={getResultsContainer:n=>n.settings,dataSource:"ST",getSuggestionType:()=>"ST",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>{if(n.isModernSetting(t)){let i=t.glyph,u;return u=n.config.useCobaltCSS&&t.glyphFontFamily==="Settings Fluent Icons"?{content:i,type:8}:i?{content:i,type:1}:n.ScopeConfig[n.Scope.Settings].icon,v(t,r,u)}return i(t,r,u,n.ScopeConfig[n.Scope.Settings].icon)},supportsEmptyQuery:!1},d=[h,k,{getResultsContainer:n=>n.media,dataSource:"LM",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:n=>n.files,dataSource:"FL",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:()=>{throw Error("Only supported via IndexerQuery");},dataSource:"IBA",getSuggestionType:()=>"IBA",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon),supportsEmptyQuery:!1},{getResultsContainer:()=>{throw Error("Only supported via IndexerQuery");},dataSource:"IFF",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:n.config.win10FastFileProviderSqlOptimizations?30:7,maxAfter3chars:n.config.win10FastFileProviderSqlOptimizations?30:15,maxAfter8charsOrInL2ZeroInput:n.config.win10FastFileProviderSqlOptimizations?30:25,supportsEmptyQuery:!0},{getResultsContainer:()=>{throw Error("Only supported via IndexerQuery");},dataSource:"CoPIFF",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},],g=[{getResultsContainer:n=>n.files,dataSource:"MDOC",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.folders,dataSource:"MFOL",getSuggestionType:n=>r(n.kind,n.extension,"FD"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Folders].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.pictures,dataSource:"MPHO",getSuggestionType:n=>r(n.kind,n.extension,"LI"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Photos].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.video,dataSource:"MVID",getSuggestionType:n=>r(n.kind,n.extension,"LV"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Videos].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.music,dataSource:"MMUS",getSuggestionType:()=>"MU",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Music].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.files,dataSource:"MPVD",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0),supportsEmptyQuery:!1},],nt=[{getResultsContainer:n=>SearchAppWrapper.CortanaApp.queryFormulationView.startPathCompletionQuery(n.originalQuery,""),dataSource:"PT",getSuggestionType:()=>"PT",maxUpTo3chars:15,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:15,customCancellation:()=>SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastPathCompletionQuery(),supportsEmptyQuery:!1},{getResultsContainer:()=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getRecentAppsAsync(),getResults:n=>n,dataSource:"LRA",getSuggestionType:()=>"PP",customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0},{getResultsContainer:t=>ThresholdUtilities.createPromise(i=>{let r=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.recentSearches||[];if(r=r.filter(n=>!!n),r.length>0&&t.queryToFetch){const i=n.escapeRegex(t.queryToFetch),u=i.split(/\s+/).filter(n=>!!n).map(n=>new RegExp("^"+n+"| "+n,"i"));r=r.filter(n=>u.every(t=>t.test(n)))}let u=vt(r);i(u)}),getResults:n=>n,dataSource:"FEH",getSuggestionType:()=>"FEH",customCreateLocalResponseSuggestion:(n,t)=>{return v(n,t,{type:2,content:"&#xE81C"})},supportsEmptyQuery:!0},{getResultsContainer:()=>y(),getResults:(n,t)=>n.then(n=>t?n.slice(0,t):n),dataSource:"TOPP",getSuggestionType:()=>"TOPL",customGetMax:t=>n.shouldShowStaticSearchHome(t)?6:5,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0}],tt=[{getResultsContainer:n=>SearchAppWrapper.CortanaApp.queryFormulationView.startCommandLineQuery(n.originalQuery,""),dataSource:"CG",getSuggestionType:()=>"CG",customCancellation:()=>SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastCommandLineQuery(),supportsEmptyQuery:!1},];n.LocalDataProviderDataSources=d.concat(g).concat(nt).concat(tt).map(n=>n.dataSource);const u={suggestions:[],maxedOut:!1};let it={},e={"shell:RecycleBinFolder":{icon:{content:"&#xEF87",type:2},locStringKey:"RecycleBin"}};const kt=["\\system32\\user.exe","\\system32\\sidebar.exe","\\system32\\at.exe","\\system32\\change.exe","\\system32\\control.exe","\\system32\\find.exe","\\system32\\net.exe","\\system32\\share.exe","\\system32\\rundll32.exe","\\system32\\append.exe","\\system32\\choice.exe","\\system32\\clip.exe","\\system32\\comp.exe","\\system32\\compact.exe","\\system32\\consent.exe","\\system32\\convert.exe","\\system32\\format.exe","\\system32\\graphics.com","\\system32\\label.exe","\\system32\\mem.exe","\\system32\\mode.com","\\system32\\more.com","\\system32\\recover.exe","\\system32\\replace.exe","\\system32\\reset.exe","\\system32\\shadow.exe","\\system32\\sort.exe","\\system32\\tree.com","\\system32\\webcam.exe","\\system32\\systemsettings.exe","\\system32\\command.com","\\system32\\tabtip.exe","\\system32\\services.exe","\\system32\\help.exe","\\system32\\where.exe","\\system32\\skydrive.exe","\\system32\\calc.exe","\\system32\\fc.exe","\\accessories\\wordpad.exe",n.config.blocklistNotepadCommand?"\\system32\\notepad.exe":null,].filter(n=>!!n),ut=["\\system32\\finger.exe","\\system32\\ping.exe","\\system32\\print.exe","\\system32\\shutdown.exe","\\system32\\expand.exe","\\system32\\tskill.exe","\\system32\\reg.exe","\\system32\\sc.exe",],dt=["uninstall","outlook","excel","skype","nero","onenote","lync","vmware","firefox","itunes","photoshop","print","opera","visio","thunderbird","smartscreen"],gt=/[\/\.\-\\]/;n.isRealCommand=ni;const ti=["Microsoft.Cortana_8wekyb3d8bbwe!CortanaUI","Microsoft.Windows.Cortana_cw5n1h2txyewy!CortanaUI",],ii=[".dll",".pdb",".obj",".bin",".etl",".bak",".config",".resx",".manifest",".ini",".searchconnector-ms",".settingcontent-ms",".vstx",".vssx",".ms-one-stub",],ri=["visio content","bin","debug","obj","objd","amd64","x86","microsoftedgebackups",];n.isInitials=et;n.getSuggestionTypeOverride=st;n.parseConstraintIndexMetaData=ht;n.isSuppressed=ct;class t{getName(){return"LocalDataProvider"}constructor(t){this._previousKeystrokeCache=t;n.Host.bindAppHidden(()=>{it={}})}static setWhereId(n){var r,i;if(!n||n.close){if(t.lastResultHandle&&!n){(i=(r=t.lastResultHandle).close)===null||i===void 0?void 0:i.call(r);t.lastResultHandle=null;return}t.lastResultHandle=n}}fetch(i,r,u,f,e){var l,a,v,y;f&&f.register(()=>n.Async.clearPendingItemsFromCache(),!1,"clea